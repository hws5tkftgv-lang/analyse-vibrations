<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Courroie & poulies ‚Äî trajectoire correcte</title>

<style>
:root{
  --bg:#0b1436;
  --text:#eaf1ff;
  --muted:rgba(234,241,255,.7);
  --btn:#1c2b6a;
  --bad:#ff4d4d;
}
*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html,body{ margin:0; background:var(--bg); color:var(--text); font-family:Arial,sans-serif; }

header{ padding:10px 14px; font-size:16px; font-weight:700; }

.controls{
  padding:10px 14px;
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
}
.controls label{ font-size:12px; color:var(--muted); }
.controls input,.controls select{
  width:100%; padding:6px 8px; font-size:13px;
  border-radius:10px; border:none;
}
.controls .full{ grid-column:1/-1; }

.outputBox{
  background:rgba(255,255,255,.08);
  border-radius:12px;
  padding:10px;
  font-size:13px;
  line-height:1.4;
}
.outputBox b{ color:#cfe2ff; }

.buttons{
  display:flex; gap:10px; padding:0 14px 10px; flex-wrap:wrap;
}
button{
  flex:1; min-width:120px;
  padding:10px;
  font-size:15px;
  border:none;
  border-radius:12px;
  background:var(--btn);
  color:white;
}

.stage{ padding:10px 14px; }
canvas{ width:100%; background:#000; border-radius:12px; display:block; }
#spectrum{ background:#05080f; touch-action:none; }

.results{ padding:10px 14px 18px; font-size:14px; line-height:1.45; }
.bad{ color:var(--bad); font-weight:700; }

/* ===== FULLSCREEN ===== */
canvas.spectrum-only{
  position:fixed;
  inset:0;
  width:100dvw !important;
  height:100dvh !important;
  border-radius:0 !important;
  z-index:9999;
}
body.spectrum-mode > *:not(#specStage):not(#fsHUD):not(#rotateWarn){
  display:none !important;
}
body.spectrum-mode{ overflow:hidden; }

/* HUD */
#fsHUD{
  position:fixed;
  top:12px; left:12px;
  background:rgba(0,0,0,.4);
  padding:10px 12px;
  border-radius:12px;
  font-size:13px;
  display:none;
  z-index:10001;
}
#fsHUD button{
  background:#b71c1c;
}

/* Rotation */
#rotateWarn{
  position:fixed;
  inset:0;
  background:rgba(5,8,15,.9);
  display:none;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-size:18px;
  font-weight:700;
  z-index:10000;
}
</style>
</head>

<body>

<header>üîÑ Courroie & poulies ‚Äî trajectoire correcte</header>

<div class="controls">
  <label>RPM moteur <input id="rpm" type="number" value="1500"></label>
  <label>Unit√©s
    <select id="unit">
      <option value="imperial">po</option>
      <option value="metric">mm</option>
    </select>
  </label>
  <label>√ò menante <input id="d1" type="number" value="4"></label>
  <label>√ò men√©e <input id="d2" type="number" value="9"></label>
  <label class="full">C-C <input id="cc" type="number" value="21"></label>

  <div class="outputBox full">
    <div><b>Menante</b> : <span id="out-rpm1"></span> RPM | <span id="out-hz1"></span> Hz</div>
    <div><b>Men√©e</b> : <span id="out-rpm2"></span> RPM | <span id="out-hz2"></span> Hz</div>
    <div><b>Courroie</b> : <span id="out-hzbelt"></span> Hz | <span id="out-fpm"></span> ft/min</div>
    <div><b>Longueur</b> : <span id="out-length"></span></div>
  </div>
</div>

<div class="buttons">
  <button id="play">Play</button>
  <button id="pause">Pause</button>
  <button id="reset">Reset</button>
  <button id="enterFS">üîç Plein √©cran spectre</button>
</div>

<div class="stage" id="sceneStage"><canvas id="scene"></canvas></div>
<div class="stage" id="specStage"><canvas id="spectrum"></canvas></div>

<div id="fsHUD"><button id="exitFS">‚ùå Quitter</button></div>
<div id="rotateWarn">üîÑ Tournez le t√©l√©phone</div>

<script>
(() => {
"use strict";

/* ===== DOM ===== */
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");
const specCanvas = document.getElementById("spectrum");
const specCtx = specCanvas.getContext("2d");

const enterFS = document.getElementById("enterFS");
const exitFS  = document.getElementById("exitFS");
const fsHUD   = document.getElementById("fsHUD");
const rotateWarn = document.getElementById("rotateWarn");

let spectrumFS = false;
let fsTimer = null;

/* ===== FULLSCREEN ===== */
enterFS.onclick = () => {
  spectrumFS = true;
  specCanvas.classList.add("spectrum-only");
  document.body.classList.add("spectrum-mode");
  fsHUD.style.display = "block";
  resize();
};

exitFS.onclick = () => {
  spectrumFS = false;
  specCanvas.classList.remove("spectrum-only");
  document.body.classList.remove("spectrum-mode");
  fsHUD.style.display = "none";
  rotateWarn.style.display = "none";
  resize();
};

document.addEventListener("keydown", e=>{
  if(e.key==="Escape" && spectrumFS) exitFS.click();
});

/* ===== LONG PRESS MOBILE ===== */
specCanvas.addEventListener("touchstart", ()=>{
  if(!spectrumFS) return;
  fsTimer = setTimeout(()=>fsHUD.style.display="block",2000);
});
["touchend","touchmove","touchcancel"].forEach(e=>{
  specCanvas.addEventListener(e,()=>clearTimeout(fsTimer));
});

/* ===== ORIENTATION ===== */
function checkOrientation(){
  if(!spectrumFS) return;
  if(window.innerHeight > window.innerWidth){
    rotateWarn.style.display="flex";
    fsHUD.style.display="none";
  }else{
    rotateWarn.style.display="none";
    fsHUD.style.display="block";
  }
}
window.addEventListener("resize",checkOrientation);

/* ===== RESIZE SAFE ===== */
function resize(){
  const dpr = Math.min(3,window.devicePixelRatio||1);
  const w = Math.min(720,window.innerWidth-32);
  const h = w*0.55;

  canvas.style.width=w+"px";
  canvas.style.height=h+"px";
  canvas.width=w*dpr;
  canvas.height=h*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);

  specCanvas.style.width=w+"px";
  specCanvas.style.height=Math.max(240,h)+"px";
  specCanvas.width=w*dpr;
  specCanvas.height=Math.max(240,h)*dpr;
  specCtx.setTransform(dpr,0,0,dpr,0,0);
}

/* ===== DESSIN TEST ===== */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle="#00a2ff";
  ctx.beginPath();
  ctx.arc(150,canvas.height/2,40,0,Math.PI*2);
  ctx.stroke();
}

resize();
draw();
})();
</script>
</body>
</html>