<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Courroie & poulies â€” spectre pÃ©dagogique</title>

<style>
:root{
  --bg:#0b1436; --text:#eaf1ff; --muted:#9fb3ff;
  --blue:#00a2ff; --orange:#ff9800; --btn:#1c2b6a; --bad:#ff4d4d;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:Arial}
header{padding:10px 14px;font-weight:700}
.controls{padding:10px 14px;display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.controls label{font-size:12px;color:var(--muted)}
.controls input,.controls select{width:100%;padding:5px;border-radius:8px;border:none}
.controls .full{grid-column:1/-1}
.buttons{display:flex;gap:10px;padding:0 14px 10px}
button{flex:1;padding:10px;border:none;border-radius:12px;background:var(--btn);color:#fff}
.stage{padding:10px 14px}
canvas{width:100%;background:#000;border-radius:12px}
#spectrum{background:#05080f}

.outputBox{background:rgba(255,255,255,.08);border-radius:12px;padding:10px;font-size:13px}
.bad{color:var(--bad);font-weight:700}

.lock-scroll{overflow:hidden;height:100vh}
canvas.spectrum-only{position:fixed;inset:0;width:100vw!important;height:100vh!important;border-radius:0;z-index:9999}

body.spectrum-mode header,
body.spectrum-mode .controls,
body.spectrum-mode .buttons,
body.spectrum-mode #sceneStage,
body.spectrum-mode #info{display:none!important}

.rotate-warning{
  position:fixed;inset:0;z-index:10000;
  background:rgba(5,8,15,.85);
  display:flex;align-items:center;justify-content:center;
  font-size:18px;font-weight:700;text-align:center
}
</style>
</head>

<body>
<header>ðŸ”„ Courroie & poulies â€” spectre pÃ©dagogique</header>

<div class="controls">
<label>RPM moteur<input id="rpm" type="number" value="1500"></label>
<label>UnitÃ©s<select id="unit"><option value="imperial">po</option><option value="metric">mm</option></select></label>
<label>Ã˜ menante<input id="d1" type="number" value="4"></label>
<label>Ã˜ menÃ©e<input id="d2" type="number" value="9"></label>
<label class="full">C-C<input id="cc" type="number" value="21"></label>

<div class="outputBox full">
<div>Menante : <span id="out-rpm1">â€”</span> RPM | <span id="out-hz1">â€”</span> Hz</div>
<div>MenÃ©e : <span id="out-rpm2">â€”</span> RPM | <span id="out-hz2">â€”</span> Hz</div>
<div>Courroie : <span id="out-hzbelt">â€”</span> Hz | <span id="out-fpm">â€”</span> ft/min</div>
<div>Longueur : <span id="out-length">â€”</span></div>
</div>

<label class="full">DÃ©faut simulÃ©
<select id="fault">
<option value="none">Aucun</option>
<option value="unbalance">Balourd</option>
<option value="misalign">DÃ©salignement</option>
<option value="looseness">Jeu mÃ©canique</option>
<option value="belt">DÃ©faut courroie</option>
<option value="slip">Glissement</option>
<option value="bearing">Roulement</option>
<option value="resonance">RÃ©sonance</option>
<option value="all">TOUT</option>
</select>
</label>

<label class="full">Ralenti<input id="slow" type="range" min="1" max="20" value="8"></label>
</div>

<div class="buttons">
<button id="play">Play</button>
<button id="pause">Pause</button>
<button id="reset">Reset</button>
<button id="fs">Full screen</button>
</div>

<div class="stage" id="sceneStage"><canvas id="scene"></canvas></div>
<div class="stage" id="specStage"><canvas id="spectrum"></canvas></div>

<div id="info"></div>
<div id="rotateWarn" class="rotate-warning" style="display:none">Tournez le tÃ©lÃ©phone en paysage</div>

<script>
/* === JS COMPLET (stable) === */
(() => {
const scene=document.getElementById("scene"),ctx=scene.getContext("2d");
const spec=document.getElementById("spectrum"),sctx=spec.getContext("2d");
const rpmEl=d1El=d2El=ccEl=null;

let running=false,lastTS=null,t=0,specTime=0;
let spectrumFS=false;
const view={min:0,span:50,max:300};

const rpmI=document.getElementById("rpm"),
d1I=document.getElementById("d1"),
d2I=document.getElementById("d2"),
ccI=document.getElementById("cc"),
unit=document.getElementById("unit"),
fault=document.getElementById("fault"),
slow=document.getElementById("slow");

const outRPM1=document.getElementById("out-rpm1"),
outHZ1=document.getElementById("out-hz1"),
outRPM2=document.getElementById("out-rpm2"),
outHZ2=document.getElementById("out-hz2"),
outHZB=document.getElementById("out-hzbelt"),
outFPM=document.getElementById("out-fpm"),
outLen=document.getElementById("out-length"),
info=document.getElementById("info");

function resize(){
const dpr=Math.min(3,devicePixelRatio||1);
const w=Math.min(innerWidth-24,720),h=w*.55;
scene.width=w*dpr;scene.height=h*dpr;
scene.style.width=w+"px";scene.style.height=h+"px";
ctx.setTransform(dpr,0,0,dpr,0,0);

let sw=w,sh=Math.max(220,h*.95);
if(spectrumFS){
const vv=visualViewport||{width:innerWidth,height:innerHeight};
sw=vv.width;sh=vv.height;
spec.classList.add("spectrum-only");
}else spec.classList.remove("spectrum-only");

spec.width=sw*dpr;spec.height=sh*dpr;
spec.style.width=sw+"px";spec.style.height=sh+"px";
sctx.setTransform(dpr,0,0,dpr,0,0);
}
addEventListener("resize",resize);

function drawSpectrum(fm,fb,time){
const W=spec.width/(devicePixelRatio||1),
H=spec.height/(devicePixelRatio||1);
sctx.clearRect(0,0,W,H);
sctx.fillStyle="#05080f";sctx.fillRect(0,0,W,H);

const gridTop=20,gridBot=H-50;
const plotL=60,plotW=W-plotL;
const min=view.min,max=min+view.span;
const sx=plotW/(max-min);

sctx.strokeStyle="rgba(255,255,255,.1)";
for(let i=0;i<=10;i++){
const y=gridBot-i*(gridBot-gridTop)/10;
sctx.beginPath();sctx.moveTo(plotL,y);sctx.lineTo(W,y);sctx.stroke();
sctx.fillStyle="#cfd6ff";sctx.textAlign="right";sctx.fillText(i+" mm/s",plotL-6,y);
}

for(let hz=min;hz<=max;hz+=10){
const x=plotL+(hz-min)*sx;
sctx.strokeStyle="#555";
sctx.beginPath();sctx.moveTo(x,gridBot);sctx.lineTo(x,gridBot+10);sctx.stroke();
sctx.fillStyle="#fff";sctx.textAlign="center";sctx.fillText(hz+" Hz",x,gridBot+22);
}

const peaks=[];
const t1=time,t2=time*1.7,t3=time*2.3;

peaks.push({f:fm,a:1+0.2*Math.sin(t1),c:"#00a2ff",l:"1Ã— moteur"});
if(fault.value==="unbalance"||fault.value==="all")peaks.push({f:fm,a:2+0.3*Math.sin(t1),c:"#ff5555",l:"Balourd"});
if(fault.value==="misalign"||fault.value==="all"){
peaks.push({f:fm,a:1.3,c:"#ff9800",l:"DÃ©salign. 1Ã—"});
peaks.push({f:fm*2,a:1.6,c:"#ff9800",l:"DÃ©salign. 2Ã—"});
}
if(fault.value==="belt"||fault.value==="all"){
peaks.push({f:fb,a:1.2,c:"#fff",l:"Courroie"});
}
if(fault.value==="slip"||fault.value==="all"){
peaks.push({f:fb*(.92+.08*Math.sin(t1)),a:1.1,c:"#ffcc00",l:"Glissement"});
}
if(fault.value==="bearing"||fault.value==="all"){
peaks.push({f:fm*4.2,a:.8,c:"#c77dff",l:"Roulement"});
}

peaks.forEach(p=>{
if(p.f<min||p.f>max)return;
const x=plotL+(p.f-min)*sx;
const h=p.a/10*(gridBot-gridTop);
sctx.strokeStyle=p.c;sctx.lineWidth=3;
sctx.beginPath();sctx.moveTo(x,gridBot);sctx.lineTo(x,gridBot-h);sctx.stroke();
sctx.fillStyle="#fff";sctx.fillText(p.l,x,gridBot-h-6);
});
}

function loop(ts){
if(!lastTS)lastTS=ts;
const dt=(ts-lastTS)/1000;lastTS=ts;
if(running){t+=dt;specTime+=dt;}
drawSpectrum(rpmI.value/60, (rpmI.value/60), specTime);
requestAnimationFrame(loop);
}

document.getElementById("play").onclick=()=>running=true;
document.getElementById("pause").onclick=()=>running=false;
document.getElementById("reset").onclick=()=>{running=false;t=specTime=0};

document.getElementById("fs").onclick=()=>{
spectrumFS=!spectrumFS;
document.body.classList.toggle("spectrum-mode",spectrumFS);
document.body.classList.toggle("lock-scroll",spectrumFS);
resize();
};

resize();requestAnimationFrame(loop);
})();
</script>
</body>
</html>