<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Courroie & poulies â€” trajectoire correcte</title>

<style>
html,body{
  margin:0;
  background:#0b1436;
  color:#eaf1ff;
  font-family:Arial,system-ui,sans-serif;
}
header{
  padding:14px;
  font-size:18px;
  font-weight:700;
}
.controls{
  padding:14px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.controls label{ font-size:13px; }
.controls input, .controls select{
  width:100%;
  padding:10px;
  font-size:15px;
  border-radius:10px;
  border:none;
}
.controls .full{ grid-column:1/-1; }

canvas{
  width:100%;
  background:#000;
  display:block;
  border-radius:14px;
}

.info{
  padding:14px;
  font-size:14px;
}
.dot{
  display:inline-block;
  width:10px;height:10px;
  border-radius:50%;
  margin-right:6px;
}
.blue{background:#00a2ff;}
.orange{background:#ff9800;}
.white{background:#fff;}
</style>
</head>

<body>
<header>ðŸ”„ Courroie & poulies â€” trajectoire correcte</header>

<div class="controls">
  <label>RPM moteur
    <input id="rpm" type="number" value="1500">
  </label>
  <label>UnitÃ©s
    <select id="unit">
      <option value="imperial">po</option>
      <option value="metric">mm</option>
    </select>
  </label>
  <label>Ã˜ menante
    <input id="d1" type="number" value="4">
  </label>
  <label>Ã˜ menÃ©e
    <input id="d2" type="number" value="9">
  </label>
  <label class="full">Centre-centre
    <input id="cc" type="number" value="21">
  </label>
</div>

<canvas id="scene"></canvas>
<div class="info" id="info"></div>

<script>
(() => {
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");

const rpmEl=document.getElementById("rpm");
const d1El=document.getElementById("d1");
const d2El=document.getElementById("d2");
const ccEl=document.getElementById("cc");
const unitEl=document.getElementById("unit");
const infoEl=document.getElementById("info");

const TAU=Math.PI*2;
const IN_TO_MM=25.4;

let t=0,lastTS=0;

function resize(){
  const w=Math.min(innerWidth-20,720);
  const h=w*0.55;
  const dpr=Math.min(3,devicePixelRatio||1);
  canvas.style.width=w+"px";
  canvas.style.height=h+"px";
  canvas.width=w*dpr;
  canvas.height=h*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
addEventListener("resize",resize);
resize();

function loop(ts){
  if(!lastTS) lastTS=ts;
  const dt=(ts-lastTS)/1000;
  lastTS=ts;
  t+=dt;
  draw();
  requestAnimationFrame(loop);
}

function draw(){
  const rpm=+rpmEl.value||0;
  let d1=+d1El.value||1;
  let d2=+d2El.value||1;
  let cc=+ccEl.value||1;

  if(unitEl.value==="imperial"){
    d1*=IN_TO_MM; d2*=IN_TO_MM; cc*=IN_TO_MM;
  }

  ctx.clearRect(0,0,canvas.width,canvas.height);

  const r1mm=d1/2, r2mm=d2/2;
  const Cmm=Math.max(cc,Math.abs(r2mm-r1mm)+1);

  const W=parseFloat(canvas.style.width);
  const H=parseFloat(canvas.style.height);
  const margin=40;

  const scale=Math.min(
    (W-2*margin)/(Cmm+r1mm+r2mm),
    (H-2*margin)/(2*Math.max(r1mm,r2mm))
  );

  const r1=r1mm*scale, r2=r2mm*scale;
  const C=Cmm*scale;

  const x1=margin+r1;
  const x2=x1+C;
  const y=H/2;

  const phi=Math.acos((r2-r1)/C);

  // points de tangence
  const Ltop={x:x1+r1*Math.cos(phi),y:y+r1*Math.sin(phi)};
  const Lbot={x:x1+r1*Math.cos(-phi),y:y+r1*Math.sin(-phi)};
  const Rtop={x:x2+r2*Math.cos(Math.PI-phi),y:y+r2*Math.sin(Math.PI-phi)};
  const Rbot={x:x2+r2*Math.cos(Math.PI+phi),y:y+r2*Math.sin(Math.PI+phi)};

  // ===== COURROIE =====
  ctx.strokeStyle="#9a9a9a";
  ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(Ltop.x,Ltop.y);
  ctx.lineTo(Rtop.x,Rtop.y);

  // grande poulie : arc LONG convexe
  ctx.arc(x2,y,r2,Math.PI-phi,Math.PI+phi,false);

  ctx.lineTo(Lbot.x,Lbot.y);

  // petite poulie : arc COURT convexe (CORRECTION CLÃ‰)
  ctx.arc(x1,y,r1,-phi,phi,false);

  ctx.stroke();

  // ===== POULIES =====
  function pulley(cx,cy,r,col,ang){
    ctx.strokeStyle=col;
    ctx.lineWidth=3;
    ctx.beginPath();
    ctx.arc(cx,cy,r,0,TAU);
    ctx.stroke();
    ctx.fillStyle=col;
    ctx.beginPath();
    ctx.arc(cx+(r-6)*Math.cos(ang),cy+(r-6)*Math.sin(ang),6,0,TAU);
    ctx.fill();
  }

  const w1=TAU*(rpm/60);
  const rpm2=rpm*(d1/d2);
  const w2=TAU*(rpm2/60);

  pulley(x1,y,r1,"#00a2ff",-w1*t);
  pulley(x2,y,r2,"#ff9800",-w2*t);

  // ===== POINT SUR COURROIE =====
  const lenTop=Math.hypot(Rtop.x-Ltop.x,Rtop.y-Ltop.y);
  const lenBot=Math.hypot(Lbot.x-Rbot.x,Lbot.y-Rbot.y);
  const lenArcR=r2*(2*phi);
  const lenArcL=r1*(2*phi);
  const L=lenTop+lenArcR+lenBot+lenArcL;

  const v=Math.abs(w1)*r1;
  let s=(v*t)%L;
  let P;

  if(s<lenTop){
    const u=s/lenTop;
    P={x:Ltop.x+(Rtop.x-Ltop.x)*u,y:Ltop.y+(Rtop.y-Ltop.y)*u};
  }else if((s-=lenTop)<lenArcR){
    const u=s/lenArcR;
    const a=(Math.PI-phi)+u*(2*phi);
    P={x:x2+r2*Math.cos(a),y:y+r2*Math.sin(a)};
  }else if((s-=lenArcR)<lenBot){
    const u=s/lenBot;
    P={x:Rbot.x+(Lbot.x-Rbot.x)*u,y:Rbot.y+(Lbot.y-Rbot.y)*u};
  }else{
    s-=lenBot;
    const u=s/lenArcL;
    const a=-phi+u*(2*phi);
    P={x:x1+r1*Math.cos(a),y:y+r1*Math.sin(a)};
  }

  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(P.x,P.y,5,0,TAU);
  ctx.fill();

  infoEl.innerHTML=`
  <div><span class="dot blue"></span>Menante : ${rpm.toFixed(0)} RPM</div>
  <div><span class="dot orange"></span>MenÃ©e : ${rpm2.toFixed(0)} RPM</div>
  <div><span class="dot white"></span>Trajectoire correcte</div>
  `;
}

requestAnimationFrame(loop);
})();
</script>
</body>
</html>