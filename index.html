<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Spectre vibrations â€“ Courroie & Poulies</title>

<style>
:root{
  --bg:#0b1436;
  --panel:#101a40;
  --text:#eaf1ff;
  --muted:rgba(234,241,255,.7);
  --btn:#1c2b6a;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:Arial,sans-serif}

header{padding:10px 14px;font-size:16px;font-weight:700}
.controls{padding:10px 14px;display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.controls label{font-size:12px;color:var(--muted)}
.controls input,.controls select{width:100%;padding:6px;border-radius:8px;border:none}
.controls .full{grid-column:1/-1}

.buttons{display:flex;gap:10px;padding:0 14px 10px}
button{flex:1;padding:10px;border:none;border-radius:12px;background:var(--btn);color:#fff;font-size:15px}

.stage{padding:10px 14px}
canvas{width:100%;background:#000;border-radius:12px;display:block}

.outputBox{background:rgba(255,255,255,.08);border-radius:12px;padding:10px;font-size:13px;line-height:1.4}

.rotate-warning{
  position:fixed;inset:0;z-index:9999;
  background:rgba(0,0,0,.85);
  display:none;align-items:center;justify-content:center;
  text-align:center;font-size:18px;font-weight:700
}

/* ===== FULL SCREEN SPECTRE ===== */
body.spectrum-mode header,
body.spectrum-mode .controls,
body.spectrum-mode .buttons,
body.spectrum-mode #sceneStage,
body.spectrum-mode .outputBox{
  display:none!important
}
body.spectrum-mode #specStage{padding:0!important}
body.spectrum-mode{overflow:hidden;height:100vh}

canvas.spectrum-only{
  position:fixed;inset:0;
  width:100vw!important;height:100vh!important;
  border-radius:0!important;z-index:9998
}
</style>
</head>

<body>

<header>ðŸ“Š Spectre de vibrations â€“ Courroie & Poulies</header>

<div class="controls">
  <label>RPM moteur <input id="rpm" type="number" value="1500"></label>
  <label>Ã˜ menante <input id="d1" type="number" value="4"></label>
  <label>Ã˜ menÃ©e <input id="d2" type="number" value="9"></label>
  <label class="full">Centre-centre <input id="cc" type="number" value="21"></label>

  <label class="full">DÃ©faut simulÃ©
    <select id="fault">
      <option value="none">Aucun (normal)</option>
      <option value="unbalance">Balourd</option>
      <option value="misalign">DÃ©salignement</option>
      <option value="looseness">Jeu mÃ©canique</option>
      <option value="belt">DÃ©faut de courroie</option>
      <option value="slip">Glissement courroie</option>
      <option value="bearing">DÃ©faut de roulement</option>
      <option value="resonance">RÃ©sonance structurelle</option>
      <option value="all">TOUT</option>
    </select>
  </label>
</div>

<div class="buttons">
  <button id="play">Play</button>
  <button id="pause">Pause</button>
  <button id="reset">Reset</button>
  <button id="fs">Full screen</button>
</div>

<div class="stage" id="sceneStage">
  <canvas id="scene"></canvas>
</div>

<div class="stage" id="specStage">
  <canvas id="spectrum"></canvas>
</div>

<div class="rotate-warning" id="rotateWarn">
  ðŸ”„ Tournez le tÃ©lÃ©phone en mode paysage
</div>

<script>
(() => {

const scene = document.getElementById("scene");
const spectrum = document.getElementById("spectrum");
const ctx = scene.getContext("2d");
const specCtx = spectrum.getContext("2d");

const rpmEl = document.getElementById("rpm");
const d1El = document.getElementById("d1");
const d2El = document.getElementById("d2");
const ccEl = document.getElementById("cc");
const faultEl = document.getElementById("fault");

const playBtn = document.getElementById("play");
const pauseBtn = document.getElementById("pause");
const resetBtn = document.getElementById("reset");
const fsBtn = document.getElementById("fs");
const rotateWarn = document.getElementById("rotateWarn");

let running = false;
let specTime = 0;
let lastTS = null;
let spectrumFS = false;

const spectrumView = { minHz:0, spanHz:50, maxHz:300 };

function resize(){
  const dpr = devicePixelRatio || 1;
  const w = innerWidth - 28;
  const h = 220;

  scene.width = w*dpr;
  scene.height = h*dpr;
  scene.style.width = w+"px";
  scene.style.height = h+"px";
  ctx.setTransform(dpr,0,0,dpr,0,0);

  const vh = spectrumFS ? innerHeight : 260;
  spectrum.width = w*dpr;
  spectrum.height = vh*dpr;
  spectrum.style.width = w+"px";
  spectrum.style.height = vh+"px";
  specCtx.setTransform(dpr,0,0,dpr,0,0);
}

function drawSpectrum(){
  const W = spectrum.width/(devicePixelRatio||1);
  const H = spectrum.height/(devicePixelRatio||1);

  specCtx.clearRect(0,0,W,H);
  specCtx.fillStyle="#05080f";
  specCtx.fillRect(0,0,W,H);

  const plotLeft = 60;
  const plotBottom = H-40;
  const plotTop = 20;
  const plotHeight = plotBottom-plotTop;

  const minHz = spectrumView.minHz;
  const maxHz = minHz + spectrumView.spanHz;
  const scaleX = (W-plotLeft)/(maxHz-minHz);

  specCtx.strokeStyle="rgba(255,255,255,.1)";
  for(let a=0;a<=10;a+=2){
    const y = plotBottom - (a/10)*plotHeight;
    specCtx.beginPath();
    specCtx.moveTo(plotLeft,y);
    specCtx.lineTo(W,y);
    specCtx.stroke();
    specCtx.fillStyle="#cfd6ff";
    specCtx.textAlign="right";
    specCtx.fillText(a+" mm/s",plotLeft-6,y+4);
  }

  specCtx.strokeStyle="rgba(255,255,255,.4)";
  specCtx.textAlign="center";
  for(let hz=minHz;hz<=maxHz;hz+=10){
    const x = plotLeft+(hz-minHz)*scaleX;
    specCtx.beginPath();
    specCtx.moveTo(x,plotBottom);
    specCtx.lineTo(x,plotBottom+8);
    specCtx.stroke();
    specCtx.fillText(hz+" Hz",x,plotBottom+18);
  }

  if(!running) return;

  const rpm = +rpmEl.value;
  const hzMotor = rpm/60;
  const hzBelt = hzMotor/5;
  const fault = faultEl.value;

  const peaks = [];
  peaks.push({hz:hzMotor,amp:2,col:"#00a2ff",label:"1Ã— moteur"});

  if(fault==="unbalance"||fault==="all")
    peaks.push({hz:hzMotor,amp:4,col:"#ff4444",label:"Balourd"});

  if(fault==="misalign"||fault==="all"){
    peaks.push({hz:hzMotor*2,amp:3,col:"#ff9800",label:"2Ã— moteur"});
  }

  if(fault==="belt"||fault==="all"){
    peaks.push({hz:hzBelt,amp:3,col:"#fff",label:"Courroie"});
  }

  if(fault==="slip"||fault==="all"){
    peaks.push({hz:hzBelt*0.92,amp:2.5,col:"#ffcc00",label:"Glissement"});
  }

  if(fault==="bearing"||fault==="all"){
    peaks.push({hz:hzMotor*4.8,amp:2,col:"#c77dff",label:"Roulement"});
  }

  if(fault==="resonance"||fault==="all"){
    peaks.push({hz:hzMotor*2.6,amp:5,col:"#ff1744",label:"RÃ©sonance"});
  }

  peaks.forEach(p=>{
    if(p.hz<minHz||p.hz>maxHz) return;
    const x = plotLeft+(p.hz-minHz)*scaleX;
    const h = (p.amp/10)*plotHeight;
    specCtx.strokeStyle=p.col;
    specCtx.lineWidth=3;
    specCtx.beginPath();
    specCtx.moveTo(x,plotBottom);
    specCtx.lineTo(x,plotBottom-h);
    specCtx.stroke();
  });
}

function loop(ts){
  if(lastTS===null) lastTS=ts;
  const dt=(ts-lastTS)/1000;
  lastTS=ts;
  if(running) specTime+=dt;
  drawSpectrum();
  requestAnimationFrame(loop);
}

playBtn.onclick=()=>running=true;
pauseBtn.onclick=()=>running=false;
resetBtn.onclick=()=>{running=false;specTime=0;drawSpectrum()};

fsBtn.onclick=()=>{
  spectrumFS=!spectrumFS;
  document.body.classList.toggle("spectrum-mode",spectrumFS);
  spectrum.classList.toggle("spectrum-only",spectrumFS);
  resize();
};

window.addEventListener("resize",resize);
resize();
requestAnimationFrame(loop);

})();
</script>

</body>
</html>