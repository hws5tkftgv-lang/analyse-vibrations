<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Analyse de vibrations â€“ Poulies & courroie</title>

<style>
body{
  margin:0;
  background:#0b1436;
  color:#eaf1ff;
  font-family:Arial,sans-serif;
}
header{
  padding:14px;
  background:#0f1a44;
  border-bottom:1px solid rgba(255,255,255,.15);
}
h1{margin:0;font-size:18px}
.panel{
  padding:14px;
  background:#101a40;
  display:grid;
  gap:14px;
}
label{font-size:13px;opacity:.85}
input,select{
  width:100%;
  padding:10px;
  font-size:16px;
  border-radius:10px;
  border:none;
}
canvas{
  display:block;
  margin:12px auto;
  background:#000;
}
.info{
  padding:14px;
  background:#0f1a44;
  font-size:14px;
}
</style>
</head>

<body>

<header>
<h1>ðŸ”„ Analyse de vibrations â€“ Poulies & courroie</h1>
</header>

<div class="panel">
<label>RPM moteur (menante)
<input id="rpm" type="number" value="1200">
</label>

<label>SystÃ¨me dâ€™unitÃ©s
<select id="unit">
<option value="metric">MÃ©trique (mm)</option>
<option value="imperial">ImpÃ©rial (po)</option>
</select>
</label>

<label>Ã˜ poulie menante
<input id="d1" type="number" value="100">
</label>

<label>Ã˜ poulie menÃ©e
<input id="d2" type="number" value="200">
</label>
</div>

<canvas id="scene" width="420" height="260"></canvas>
<div class="info" id="info"></div>

<script>
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");

let a1=0,a2=0;

function clamp(v,min,max){
  return Math.max(min,Math.min(max,v));
}

function drawBelt(x1, y1, r1, x2, y2, r2){
  const dx = x2 - x1;
  const dy = y2 - y1;
  const D  = Math.hypot(dx, dy);
  if (D <= Math.abs(r2 - r1)) return;

  const theta = Math.atan2(dy, dx);
  const alpha = Math.acos((r2 - r1) / D);

  // Angles grande poulie
  let gStart = theta + alpha;
  let gEnd   = theta - alpha;

  // Angles petite poulie (opposÃ©s)
  let pStart = gEnd + Math.PI;
  let pEnd   = gStart + Math.PI;

  // NORMALISATION (clÃ© du bug)
  if (gEnd < gStart) gEnd += Math.PI * 2;
  if (pEnd < pStart) pEnd += Math.PI * 2;

  const G1 = { x: x2 + r2 * Math.cos(gStart), y: y2 + r2 * Math.sin(gStart) };
  const G2 = { x: x2 + r2 * Math.cos(gEnd),   y: y2 + r2 * Math.sin(gEnd) };
  const P1 = { x: x1 + r1 * Math.cos(pStart), y: y1 + r1 * Math.sin(pStart) };
  const P2 = { x: x1 + r1 * Math.cos(pEnd),   y: y1 + r1 * Math.sin(pEnd) };

  ctx.strokeStyle = "#777";
  ctx.lineWidth = 4;
  ctx.beginPath();

  // Segment haut
  ctx.moveTo(P1.x, P1.y);
  ctx.lineTo(G1.x, G1.y);

  // Grande poulie â€” ARC EXTÃ‰RIEUR
  ctx.arc(x2, y2, r2, gStart, gEnd, false);

  // Segment bas
  ctx.lineTo(P2.x, P2.y);

  // Petite poulie â€” ARC EXTÃ‰RIEUR
  ctx.arc(x1, y1, r1, pEnd, pStart + Math.PI * 2, false);

  ctx.stroke();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const rpm=+rpmInput.value;
  const d1=+d1Input.value;
  const d2=+d2Input.value;

  const rpm2=rpm*(d1/d2);
  const hz1=rpm/60;
  const hz2=rpm2/60;

  const r1=32;
  const r2=r1*(d2/d1);

  const x1 = 110;
const minSpacing = 1.6 * (r1 + r2);
const x2 = Math.max(x1 + minSpacing, canvas.width - r2 - 20);
const y  = canvas.height / 2;

  drawBelt(x1,y,r1,x2,y,r2);

  // poulie menante
  ctx.save();
  ctx.translate(x1,y);
  ctx.rotate(a1);
  ctx.strokeStyle="#00a2ff";
  ctx.lineWidth=3;
  ctx.beginPath();
  ctx.arc(0,0,r1,0,Math.PI*2);
  ctx.stroke();
  ctx.fillStyle="#00a2ff";
  ctx.beginPath();
  ctx.arc(r1-4,0,4,0,Math.PI*2);
  ctx.fill();
  ctx.restore();

  // poulie menÃ©e
  ctx.save();
  ctx.translate(x2,y);
  ctx.rotate(a2);
  ctx.strokeStyle="#ff9800";
  ctx.lineWidth=3;
  ctx.beginPath();
  ctx.arc(0,0,r2,0,Math.PI*2);
  ctx.stroke();
  ctx.fillStyle="#ff9800";
  ctx.beginPath();
  ctx.arc(r2-4,0,4,0,Math.PI*2);
  ctx.fill();
  ctx.restore();

  info.innerHTML=`
ðŸ”µ Menante : ${rpm.toFixed(0)} RPM / ${hz1.toFixed(2)} Hz<br>
ðŸŸ  MenÃ©e : ${rpm2.toFixed(0)} RPM / ${hz2.toFixed(2)} Hz
`;

  const v=hz1*2*Math.PI*r1;
  a1+=v/r1*0.016;
  a2+=v/r2*0.016;

  requestAnimationFrame(draw);
}

const rpmInput=document.getElementById("rpm");
const d1Input=document.getElementById("d1");
const d2Input=document.getElementById("d2");

draw();
</script>
</body>
</html>