<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Courroie ouverte — géométrie correcte</title>

<style>
html,body{
  margin:0;
  background:#0b1436;
}
canvas{
  display:block;
  margin:20px auto;
  background:#000;
  border-radius:12px;
}
</style>
</head>

<body>
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = Math.min(innerWidth-20,700);
  canvas.height = canvas.width*0.45;
}
window.addEventListener("resize",resize);
resize();

const TAU = Math.PI*2;
let t = 0;

function loop(){
  t += 0.01;
  draw();
  requestAnimationFrame(loop);
}

function draw(){
  const W = canvas.width;
  const H = canvas.height;
  ctx.clearRect(0,0,W,H);

  // === PARAMÈTRES PHYSIQUES (FIXES POUR LE TEST) ===
  const r1 = 40;     // petite poulie
  const r2 = 90;     // grande poulie
  const cx1 = 140;
  const cx2 = W - 140;
  const cy  = H/2;

  // === GÉOMÉTRIE DES TANGENTES EXTERNES ===
  const dx = cx2 - cx1;
  const dy = 0;
  const d  = Math.hypot(dx,dy);

  const alpha = Math.acos((r2 - r1)/d);
  const beta  = Math.atan2(dy,dx);

  const a1 = beta + alpha;
  const a2 = beta - alpha;

  // points de tangence
  const S_top = { x: cx1 + r1*Math.cos(a1), y: cy + r1*Math.sin(a1) };
  const S_bot = { x: cx1 + r1*Math.cos(a2), y: cy + r1*Math.sin(a2) };
  const L_top = { x: cx2 + r2*Math.cos(a1), y: cy + r2*Math.sin(a1) };
  const L_bot = { x: cx2 + r2*Math.cos(a2), y: cy + r2*Math.sin(a2) };

  // === COURROIE (CONVEXE GARANTIE) ===
  ctx.strokeStyle="#aaa";
  ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(S_top.x,S_top.y);
  ctx.lineTo(L_top.x,L_top.y);

  // grande poulie — ARC LONG
  ctx.arc(cx2,cy,r2,a1,a2,true);

  ctx.lineTo(S_bot.x,S_bot.y);

  // petite poulie — ARC COURT
  ctx.arc(cx1,cy,r1,a2,a1,false);
  ctx.stroke();

  // === POULIES ===
  ctx.strokeStyle="#00a2ff";
  ctx.lineWidth=3;
  ctx.beginPath(); ctx.arc(cx1,cy,r1,0,TAU); ctx.stroke();

  ctx.strokeStyle="#ff9800";
  ctx.beginPath(); ctx.arc(cx2,cy,r2,0,TAU); ctx.stroke();

  // === POINT SUR COURROIE (UN SEUL SENS) ===
  const lenTop = Math.hypot(L_top.x-S_top.x, L_top.y-S_top.y);
  const lenBot = Math.hypot(S_bot.x-L_bot.x, S_bot.y-L_bot.y);
  const lenArcBig  = r2*(TAU - 2*alpha);
  const lenArcSmall= r1*(2*alpha);
  const L = lenTop+lenArcBig+lenBot+lenArcSmall;

  let s = (t*80)%L;
  let P;

  if(s<lenTop){
    const u=s/lenTop;
    P={x:S_top.x+(L_top.x-S_top.x)*u,y:S_top.y+(L_top.y-S_top.y)*u};
  }
  else if((s-=lenTop)<lenArcBig){
    const u=s/lenArcBig;
    const a=a1-u*(TAU-2*alpha);
    P={x:cx2+r2*Math.cos(a),y:cy+r2*Math.sin(a)};
  }
  else if((s-=lenArcBig)<lenBot){
    const u=s/lenBot;
    P={x:L_bot.x+(S_bot.x-L_bot.x)*u,y:L_bot.y+(S_bot.y-L_bot.y)*u};
  }
  else{
    s-=lenBot;
    const u=s/lenArcSmall;
    const a=a2+u*(2*alpha);
    P={x:cx1+r1*Math.cos(a),y:cy+r1*Math.sin(a)};
  }

  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(P.x,P.y,5,0,TAU);
  ctx.fill();
}

loop();
</script>
</body>
</html>