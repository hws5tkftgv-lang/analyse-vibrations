<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Poulies & courroie â€” simulation (physique correcte)</title>

<style>
:root{
  --bg:#0b1436;
  --text:#eaf1ff;
  --blue:#00a2ff;
  --orange:#ff9800;
  --belt:#9a9a9a;
}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:Arial;}
header{padding:10px 14px;font-weight:700}
.controls{padding:10px 14px;display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.controls label{font-size:12px}
.controls input,.controls select{padding:8px;border-radius:10px;border:none}
.controls .full{grid-column:1/-1}
.buttons{display:flex;gap:10px;padding:10px 14px}
button{flex:1;padding:10px;border:none;border-radius:12px;background:#1c2b6a;color:white}
.stage{padding:10px 14px}
canvas{width:100%;background:#000;border-radius:12px}
.results{padding:10px 14px;font-size:14px}
.dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px}
.blue{background:var(--blue)} .orange{background:var(--orange)} .white{background:#fff}
</style>
</head>

<body>
<header>ðŸ”„ Poulies & courroie â€” simulation (physique correcte)</header>

<div class="controls">
<label>RPM moteur <input id="rpm" type="number" value="1500"></label>
<label>UnitÃ©s
<select id="unit"><option value="imperial">po</option><option value="metric">mm</option></select>
</label>
<label>Ã˜ menante <input id="d1" type="number" value="4"></label>
<label>Ã˜ menÃ©e <input id="d2" type="number" value="9"></label>
<label class="full">C-C <input id="cc" type="number" value="21"></label>
<label class="full">Ralenti <input id="slow" type="range" min="1" max="20" value="8"></label>
</div>

<div class="buttons">
<button id="play">Play</button>
<button id="pause">Pause</button>
<button id="reset">Reset</button>
</div>

<div class="stage"><canvas id="c"></canvas></div>
<div class="results" id="info"></div>

<script>
(()=>{

const c=document.getElementById("c"),ctx=c.getContext("2d");
const rpmEl=rpm,d1El=d1,d2El=d2,ccEl=cc,unitEl=unit,slowEl=slow,info=info;
const TAU=Math.PI*2,IN=25.4;
let t=0,run=false,last=0;

function resize(){
 const w=Math.min(innerWidth-24,720),h=w*0.6,dpr=devicePixelRatio||1;
 c.style.width=w+"px";c.style.height=h+"px";
 c.width=w*dpr;c.height=h*dpr;ctx.setTransform(dpr,0,0,dpr,0,0);
}
addEventListener("resize",resize);resize();

function read(){
 let rpm=+rpmEl.value,d1=+d1El.value,d2=+d2El.value,cc=+ccEl.value;
 if(unitEl.value==="imperial"){d1*=IN;d2*=IN;cc*=IN}
 return{rpm,d1,d2,cc};
}

function loop(ts){
 if(!last) last=ts;
 const dt=(ts-last)/1000; last=ts;
 if(run) t+=dt/(+slowEl.value||1);
 draw();
 requestAnimationFrame(loop);
}

function draw(){
 ctx.clearRect(0,0,c.width,c.height);
 ctx.fillStyle="#000";ctx.fillRect(0,0,c.width,c.height);

 const {rpm,d1,d2,cc}=read();
 const r1=d1/2,r2=d2/2;

 const C=cc;
 if(C<=Math.abs(r2-r1)) return;

 const phi=Math.acos((r2-r1)/C);
 const span=Math.sqrt(C*C-(r2-r1)*(r2-r1));

 const scale=Math.min((c.width-80)/(C+r1+r2),(c.height-80)/(2*Math.max(r1,r2)));
 const R1=r1*scale,R2=r2*scale,Cs=C*scale;
 const x1=40+R1,x2=x1+Cs,y=c.height/2;

 const aLt= phi,aLb=-phi,aRt=Math.PI-phi,aRb=Math.PI+phi;

 const Ltop={x:x1+R1*Math.cos(aLt),y:y+R1*Math.sin(aLt)};
 const Lbot={x:x1+R1*Math.cos(aLb),y:y+R1*Math.sin(aLb)};
 const Rtop={x:x2+R2*Math.cos(aRt),y:y+R2*Math.sin(aRt)};
 const Rbot={x:x2+R2*Math.cos(aRb),y:y+R2*Math.sin(aRb)};

 ctx.strokeStyle="#9a9a9a";ctx.lineWidth=4;
 ctx.beginPath();
 ctx.moveTo(Ltop.x,Ltop.y);
 ctx.lineTo(Rtop.x,Rtop.y);
 ctx.arc(x2,y,R2,aRt,aRb,true);
 ctx.lineTo(Lbot.x,Lbot.y);
 ctx.stroke();

 const beltPath=[
  {type:"line",a:Ltop,b:Rtop},
  {type:"arc",c:{x:x2,y:y},r:R2,a0:aRt,a1:aRb},
  {type:"line",a:Rbot,b:Lbot}
 ];

 let beltLen=0;
 beltPath.forEach(s=>{
  if(s.type==="line") s.len=Math.hypot(s.b.x-s.a.x,s.b.y-s.a.y);
  else s.len=s.r*Math.abs(s.a1-s.a0);
  beltLen+=s.len;
 });

 const v= rpm*Math.PI*d1/60*scale;
 let s=(v*t)%beltLen;
 let P;

 for(const seg of beltPath){
  if(s<=seg.len){
   if(seg.type==="line"){
    const u=s/seg.len;
    P={x:seg.a.x+(seg.b.x-seg.a.x)*u,y:seg.a.y+(seg.b.y-seg.a.y)*u};
   }else{
    const u=s/seg.len;
    const a=seg.a0+u*(seg.a1-seg.a0);
    P={x:seg.c.x+seg.r*Math.cos(a),y:seg.c.y+seg.r*Math.sin(a)};
   }
   break;
  }
  s-=seg.len;
 }

 ctx.fillStyle="#fff";
 ctx.beginPath();ctx.arc(P.x,P.y,5,0,TAU);ctx.fill();

 const ang1=-TAU*(rpm/60)*t;
 const ang2=-TAU*(rpm*d1/d2/60)*t;

 function pulley(x,y,r,col,a){
  ctx.strokeStyle=col;ctx.lineWidth=3;
  ctx.beginPath();ctx.arc(x,y,r,0,TAU);ctx.stroke();
  ctx.fillStyle=col;
  ctx.beginPath();ctx.arc(x+(r-6)*Math.cos(a),y+(r-6)*Math.sin(a),6,0,TAU);ctx.fill();
 }
 pulley(x1,y,R1,"#00a2ff",ang1);
 pulley(x2,y,R2,"#ff9800",ang2);

 info.innerHTML=`
 <div><span class="dot blue"></span>Moteur : ${rpm.toFixed(0)} RPM</div>
 <div><span class="dot blue"></span>Menante : ${rpm.toFixed(0)} RPM</div>
 <div><span class="dot orange"></span>MenÃ©e : ${(rpm*d1/d2).toFixed(0)} RPM</div>
 <div><span class="dot white"></span>Longueur courroie : ${((2*span+r1*(2*phi)+r2*(TAU-2*phi))/(unitEl.value==="imperial"?IN:1)).toFixed(2)} ${unitEl.value==="imperial"?"po":"mm"}</div>`;
}

play.onclick=()=>run=true;
pause.onclick=()=>run=false;
reset.onclick=()=>{t=0;run=false};

requestAnimationFrame(loop);
})();
</script>
</body>
</html>