<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Analyse de vibrations â€“ Poulies & courroie</title>

<style>
body{
  margin:0;
  background:#0b1436;
  color:#eaf1ff;
  font-family:Arial, sans-serif;
}
header{
  padding:16px;
  background:#0f1a44;
}
h1{ font-size:18px; margin:0; }

.panel{
  padding:16px;
  background:#101a40;
  display:grid;
  grid-template-columns:1fr;
  gap:16px;
}
input, select{
  padding:12px;
  font-size:16px;
  border-radius:10px;
  border:none;
}
canvas{
  display:block;
  margin:0 auto;
  background:#000;
}
.info{
  padding:16px;
  background:#0f1a44;
}
</style>
</head>

<body>

<header>
<h1>ðŸ”„ Analyse de vibrations â€“ Poulies & courroie</h1>
</header>

<div class="panel">
  <input id="rpm" type="number" value="1200" placeholder="RPM menante">
  <select id="unit">
    <option value="metric">MÃ©trique (mm)</option>
    <option value="imperial">ImpÃ©rial (po)</option>
  </select>
  <input id="d1" type="number" value="100" placeholder="Ã˜ poulie menante">
  <input id="d2" type="number" value="400" placeholder="Ã˜ poulie menÃ©e">
</div>

<canvas id="scene" width="420" height="260"></canvas>
<div class="info" id="info"></div>

<script>
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");

let a1 = 0, a2 = 0;

// ---- ARC MANUEL (pas de ctx.arc pour la courroie)
function drawArc(cx, cy, r, aStart, aEnd){
  const step = (aEnd > aStart ? 1 : -1) * 0.03;
  ctx.beginPath();
  for(let a = aStart; Math.abs(a - aEnd) > 0.02; a += step){
    ctx.lineTo(cx + r * Math.cos(a), cy + r * Math.sin(a));
  }
  ctx.lineTo(cx + r * Math.cos(aEnd), cy + r * Math.sin(aEnd));
  ctx.stroke();
}

// ---- COURROIE GÃ‰OMÃ‰TRIQUEMENT CORRECTE
function drawBelt(x1,y1,r1,x2,y2,r2){
  const dx = x2-x1;
  const dy = y2-y1;
  const D  = Math.hypot(dx,dy);

  const theta = Math.atan2(dy,dx);
  const alpha = Math.acos((r2-r1)/D);

  const t1 = theta + alpha;
  const t2 = theta - alpha;

  const P1t = {x:x1+r1*Math.cos(t1), y:y1+r1*Math.sin(t1)};
  const P1b = {x:x1+r1*Math.cos(t2), y:y1+r1*Math.sin(t2)};
  const P2t = {x:x2+r2*Math.cos(t1), y:y2+r2*Math.sin(t1)};
  const P2b = {x:x2+r2*Math.cos(t2), y:y2+r2*Math.sin(t2)};

  ctx.strokeStyle="#777";
  ctx.lineWidth=4;

  // segment haut
  ctx.beginPath();
  ctx.moveTo(P1t.x,P1t.y);
  ctx.lineTo(P2t.x,P2t.y);
  ctx.stroke();

  // arc grande poulie
  drawArc(x2,y2,r2,t1,t2);

  // segment bas
  ctx.beginPath();
  ctx.moveTo(P2b.x,P2b.y);
  ctx.lineTo(P1b.x,P1b.y);
  ctx.stroke();

  // arc petite poulie
  drawArc(x1,y1,r1,t2,t1+Math.PI*2);
}

function drawPulley(x,y,r,angle,color){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(angle);
  ctx.strokeStyle=color;
  ctx.lineWidth=3;
  ctx.beginPath();
  ctx.arc(0,0,r,0,Math.PI*2);
  ctx.stroke();
  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.arc(r-4,0,4,0,Math.PI*2);
  ctx.fill();
  ctx.restore();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const rpm = +rpmInput.value;
  const d1  = +d1Input.value;
  const d2  = +d2Input.value;

  const rpm2 = rpm*(d1/d2);
  const hz1  = rpm/60;
  const hz2  = rpm2/60;

  const r1 = 28;
  const r2 = r1*(d2/d1);

  const x1 = 80;
  const x2 = canvas.width - r2 - 30;
  const y  = canvas.height/2;

  drawBelt(x1,y,r1,x2,y,r2);
  drawPulley(x1,y,r1,a1,"#00a2ff");
  drawPulley(x2,y,r2,a2,"#ff9800");

  info.innerHTML = `
ðŸ”µ Menante : ${rpm.toFixed(0)} RPM / ${hz1.toFixed(2)} Hz<br>
ðŸŸ  MenÃ©e : ${rpm2.toFixed(0)} RPM / ${hz2.toFixed(2)} Hz
`;

  a1 += hz1*0.04;
  a2 += hz2*0.04;

  requestAnimationFrame(draw);
}

const rpmInput = document.getElementById("rpm");
const d1Input  = document.getElementById("d1");
const d2Input  = document.getElementById("d2");
const info     = document.getElementById("info");

draw();
</script>

</body>
</html>