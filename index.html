<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Courroie ouverte — géométrie correcte</title>

<style>
html,body{
  margin:0;
  background:#0b1436;
  color:#eaf1ff;
  font-family:Arial,system-ui,sans-serif;
}
canvas{
  display:block;
  margin:20px auto;
  background:#000;
  border-radius:14px;
}
</style>
</head>

<body>

<canvas id="c" width="700" height="300"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

const TAU = Math.PI * 2;

// -------------------- PARAMÈTRES --------------------
const rSmall = 45;     // rayon petite poulie
const rLarge = 95;     // rayon grande poulie
const C      = 240;    // centre-à-centre
const y0     = 150;

const xSmall = 160;
const xLarge = xSmall + C;

// -------------------- GÉOMÉTRIE --------------------
const phi = Math.acos((rLarge - rSmall) / C);

// angles tangence
const aS_top =  phi;
const aS_bot = -phi;

const aL_top = Math.PI - phi;
const aL_bot = Math.PI + phi;

// points de tangence
const S_top = {
  x: xSmall + rSmall * Math.cos(aS_top),
  y: y0     + rSmall * Math.sin(aS_top)
};
const S_bot = {
  x: xSmall + rSmall * Math.cos(aS_bot),
  y: y0     + rSmall * Math.sin(aS_bot)
};
const L_top = {
  x: xLarge + rLarge * Math.cos(aL_top),
  y: y0     + rLarge * Math.sin(aL_top)
};
const L_bot = {
  x: xLarge + rLarge * Math.cos(aL_bot),
  y: y0     + rLarge * Math.sin(aL_bot)
};

// longueurs
const lenTop = Math.hypot(L_top.x - S_top.x, L_top.y - S_top.y);
const lenBot = Math.hypot(S_bot.x - L_bot.x, S_bot.y - L_bot.y);
const lenArcL = rLarge * (TAU - 2*phi); // arc long
const lenArcS = rSmall * (2*phi);       // arc court

const totalLen = lenTop + lenArcL + lenBot + lenArcS;

// -------------------- ANIMATION --------------------
let t = 0;

function lerp(a,b,u){
  return { x:a.x+(b.x-a.x)*u, y:a.y+(b.y-a.y)*u };
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ---- COURROIE ----
  ctx.strokeStyle="#aaa";
  ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(S_top.x,S_top.y);
  ctx.lineTo(L_top.x,L_top.y);
  ctx.arc(xLarge,y0,rLarge,aL_top,aL_bot,false); // arc long
  ctx.lineTo(S_bot.x,S_bot.y);
  ctx.arc(xSmall,y0,rSmall,aS_bot,aS_top,false); // arc court
  ctx.stroke();

  // ---- POULIES ----
  ctx.lineWidth=3;

  ctx.strokeStyle="#00a2ff";
  ctx.beginPath();
  ctx.arc(xSmall,y0,rSmall,0,TAU);
  ctx.stroke();

  ctx.strokeStyle="#ff9800";
  ctx.beginPath();
  ctx.arc(xLarge,y0,rLarge,0,TAU);
  ctx.stroke();

  // ---- POINT SUR COURROIE ----
  let s = (t % totalLen);
  let P;

  if(s <= lenTop){
    P = lerp(S_top, L_top, s/lenTop);
  } else if((s -= lenTop) <= lenArcL){
    const u = s / lenArcL;
    const a = aL_top + u*(TAU - 2*phi);
    P = { x:xLarge + rLarge*Math.cos(a), y:y0 + rLarge*Math.sin(a) };
  } else if((s -= lenArcL) <= lenBot){
    P = lerp(L_bot, S_bot, s/lenBot);
  } else {
    s -= lenBot;
    const u = s / lenArcS;
    const a = aS_bot + u*(2*phi);
    P = { x:xSmall + rSmall*Math.cos(a), y:y0 + rSmall*Math.sin(a) };
  }

  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(P.x,P.y,6,0,TAU);
  ctx.fill();

  t += 1.2;
  requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>