<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>Poulies & courroie ‚Äî p√©dagogie</title>

<style>
:root{
  --bg:#0b1436;
  --panel:#101a40;
  --text:#eaf1ff;
  --muted:rgba(234,241,255,.65);
  --blue:#00a2ff;
  --orange:#ff9800;
}
*{ box-sizing:border-box; }
html,body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Arial,system-ui,sans-serif;
}

header{
  padding:10px 14px;
  font-size:16px;
  font-weight:700;
}

.controls, .results{
  padding:10px 14px;
}

.controls{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
}

.controls label{
  font-size:12px;
  color:var(--muted);
}

.controls input, .controls select{
  width:100%;
  padding:6px 8px;
  font-size:14px;
  border-radius:6px;
  border:none;
}

.buttons{
  display:flex;
  gap:10px;
  padding:10px 14px;
}

button{
  flex:1;
  padding:10px;
  font-size:15px;
  border:none;
  border-radius:8px;
  background:#1c2b6a;
  color:white;
}

.stage{
  padding:10px 14px;
}

canvas{
  width:100%;
  background:black;
  border-radius:12px;
}

.results{
  font-size:14px;
  line-height:1.5;
}

.dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;}
.blue{background:var(--blue);}
.orange{background:var(--orange);}
.white{background:#fff;}
</style>
</head>

<body>

<header>üîÑ Poulies & courroie ‚Äî simulation</header>

<div class="controls">
  <label>RPM moteur
    <input id="rpm" type="number" placeholder="RPM">
  </label>

  <label>Unit√©s
    <select id="unit">
    
      <option value="imperial">po</option>
        <option value="metric">mm</option>
    </select>
  </label>

  <label>√ò menante
  <input id="d1" type="number" placeholder="√ò menante">
  </label>

  <label>√ò men√©e
  <input id="d2" type="number" placeholder="√ò men√©e">
  </label>

  <label>C-C
    <input id="cc" type="number" placeholder="C-C">
  </label>
</div>

<div class="buttons">
  <button id="play">‚ñ∂Ô∏è Play</button>
  <button id="pause">‚è∏ Pause</button>
  <button id="reset">üîÑ Reset</button>
</div>

<div class="stage">
  <canvas id="scene"></canvas>
</div>

<div class="results" id="info"></div>

<script>
(() => {
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");

const rpmEl = document.getElementById("rpm");
const d1El = document.getElementById("d1");
const d2El = document.getElementById("d2");
const ccEl = document.getElementById("cc");
const unitEl = document.getElementById("unit");
const infoEl = document.getElementById("info");

const playBtn = document.getElementById("play");
const pauseBtn = document.getElementById("pause");
const resetBtn = document.getElementById("reset");

const TAU = Math.PI*2;
const IN_TO_MM = 25.4;

let t = 0;
let running = false;
let lastTS = null;
let lockedWidth = null;

function lerp(p, q, u){
  return {
    x: p.x + (q.x - p.x) * u,
    y: p.y + (q.y - p.y) * u
  };
}


function resize(){
  if(lockedWidth===null){
    lockedWidth = Math.min(window.innerWidth-24,720);
  }
  const w = lockedWidth;
  const h = w*0.6;
  const dpr = Math.min(3,window.devicePixelRatio||1);

  canvas.style.width=w+"px";
  canvas.style.height=h+"px";
  canvas.width=w*dpr;
  canvas.height=h*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener("resize",resize);
resize();

playBtn.onclick = ()=> running=true;
pauseBtn.onclick = ()=> running=false;
resetBtn.onclick = ()=>{
  running=false;
  rpmEl.value = "";
d1El.value = "";
d2El.value = "";
ccEl.value = "";
running = false;
t = 0;
draw();
};

function loop(ts){
  if(!lastTS) lastTS=ts;
  const dt=(ts-lastTS)/1000;
  lastTS=ts;
  if(running) t+=dt;
  draw();
  requestAnimationFrame(loop);
}

function draw(){
  const rpm = +rpmEl.value || 0;
  let d1 = +d1El.value || 1;
  let d2 = +d2El.value || 1;
  let cc = +ccEl.value || 1;

  if(unitEl.value==="imperial"){
    d1*=IN_TO_MM;
    d2*=IN_TO_MM;
    cc*=IN_TO_MM;
  }

  const f1 = rpm / 60;
  const rpm2 = rpm * (d1 / d2);
  const f2 = rpm2 / 60;

  const w1 = TAU * f1;
  const w2 = TAU * f2;

  const ang1 = -w1 * t;
  const ang2 = -w2 * t;

  const W = parseFloat(canvas.style.width);
  const H = parseFloat(canvas.style.height);

  ctx.clearRect(0,0,W,H);
  ctx.fillStyle = "#000";
  ctx.fillRect(0,0,W,H);

  // === G√âOM√âTRIE ===
  const margin = 40;
  const r1mm = d1/2;
  const r2mm = d2/2;
  const minCC = Math.abs(r2mm - r1mm) + 1;
  const Cmm = Math.max(cc, minCC);

  const scale = Math.min(
    (W - 2*margin) / (Cmm + r1mm + r2mm),
    (H - 2*margin) / (2*Math.max(r1mm, r2mm))
  );

  const r1 = r1mm * scale;
  const r2 = r2mm * scale;
  const C  = Cmm * scale;

  const x1 = margin + r1;
  const x2 = x1 + C;
  const y  = H / 2;

  const phi = Math.acos(
    Math.min(1, Math.max(-1, (r2 - r1) / C))
  );

  const aL_top =  phi, aL_bot = -phi;
  const aR_top = Math.PI - phi;
  const aR_bot = Math.PI + phi;

  const Ltop = {x:x1+r1*Math.cos(aL_top), y:y+r1*Math.sin(aL_top)};
  const Lbot = {x:x1+r1*Math.cos(aL_bot), y:y+r1*Math.sin(aL_bot)};
  const Rtop = {x:x2+r2*Math.cos(aR_top), y:y+r2*Math.sin(aR_top)};
  const Rbot = {x:x2+r2*Math.cos(aR_bot), y:y+r2*Math.sin(aR_bot)};

  // === COURROIE ===
  ctx.strokeStyle = "#9a9a9a";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(Ltop.x, Ltop.y);
  ctx.lineTo(Rtop.x, Rtop.y);
  ctx.arc(x2, y, r2, aR_top, aR_bot);
  ctx.lineTo(Lbot.x, Lbot.y);
  ctx.arc(x1, y, r1, aL_bot, aL_top);
  ctx.stroke();

  // === POULIES ===
  function drawPulley(cx, cy, r, col, a){
    ctx.strokeStyle = col;
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, TAU);
    ctx.stroke();
    ctx.fillStyle = col;
    ctx.beginPath();
    ctx.arc(
      cx + (r-6)*Math.cos(a),
      cy + (r-6)*Math.sin(a),
      6, 0, TAU
    );
    ctx.fill();
  }

  drawPulley(x1, y, r1, "#00a2ff", ang1);
  drawPulley(x2, y, r2, "#ff9800", ang2);

  // === POINT SUR COURROIE ===
  const v = Math.abs(w1) * r1;
  const lenTop = Math.hypot(Rtop.x-Ltop.x, Rtop.y-Ltop.y);
  const lenBot = Math.hypot(Lbot.x-Rbot.x, Lbot.y-Rbot.y);
  const lenArcR = r2 * (TAU - 2*phi);
  const lenArcL = r1 * (TAU - 2*phi);
  const beltLen = lenTop + lenArcR + lenBot + lenArcL;

  let s = (v * t) % beltLen, P;

  if(s <= lenTop){
    P = lerp(Ltop, Rtop, s/lenTop);
  } else if((s -= lenTop) <= lenArcR){
    const u = s / lenArcR;
    const a = aR_top - u*(TAU - 2*phi);
    P = {x:x2+r2*Math.cos(a), y:y+r2*Math.sin(a)};
  } else if((s -= lenArcR) <= lenBot){
    P = lerp(Rbot, Lbot, s/lenBot);
  } else {
    s -= lenBot;
    const u = s / lenArcL;
    const a = aL_bot - u*(TAU - 2*phi);
    P = {x:x1+r1*Math.cos(a), y:y+r1*Math.sin(a)};
  }

  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(P.x, P.y, 5, 0, TAU);
  ctx.fill();

  // === INFOS ===
  const v_mm_min = rpm * Math.PI * d1;
  infoEl.innerHTML = `
    <div>üîµ Menante : ${rpm.toFixed(0)} RPM | ${f1.toFixed(2)} Hz | ${(f1*60).toFixed(0)} CPM</div>
    <div>üü† Men√©e : ${rpm2.toFixed(0)} RPM | ${f2.toFixed(2)} Hz | ${(f2*60).toFixed(0)} CPM</div>
    <div>‚ö™ Courroie : ${v_mm_min.toFixed(0)} ${unitEl.value==="imperial"?"po":"mm"}/min</div>
  `;
}

requestAnimationFrame(loop);
})();
</script>
</body>
</html>