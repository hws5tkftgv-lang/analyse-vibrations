<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Test â€“ Courroie seule</title>

<style>
html,body{
  margin:0;
  background:#0b1436;
  color:#eaf1ff;
  font-family:Arial,system-ui,sans-serif;
}
header{ padding:12px; font-weight:700; }
.controls{ padding:12px; display:grid; gap:8px; }
canvas{
  width:100%;
  background:#000;
  border-radius:12px;
  display:block;
}
</style>
</head>

<body>
<header>ðŸ§ª Test â€” Courroie seule (sans poulies)</header>

<div class="controls">
RPM <input id="rpm" type="number" value="120">
Ã˜ menante <input id="d1" type="number" value="100">
Ã˜ menÃ©e <input id="d2" type="number" value="400">
C-C <input id="cc" type="number" value="600">
</div>

<canvas id="scene"></canvas>

<script>
(() => {
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");

const rpmEl = document.getElementById("rpm");
const d1El  = document.getElementById("d1");
const d2El  = document.getElementById("d2");
const ccEl  = document.getElementById("cc");

const TAU = Math.PI*2;
const IN_TO_MM = 25.4;

let t=0, lastTS=null;

function lerp(p,q,u){
  return { x:p.x+(q.x-p.x)*u, y:p.y+(q.y-p.y)*u };
}

function resize(){
  const w = Math.min(innerWidth-24,720);
  const h = w*0.6;
  const dpr = devicePixelRatio||1;
  canvas.style.width=w+"px";
  canvas.style.height=h+"px";
  canvas.width=w*dpr;
  canvas.height=h*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
addEventListener("resize",resize);
resize();

function loop(ts){
  if(!lastTS) lastTS=ts;
  const dt=(ts-lastTS)/1000;
  lastTS=ts;
  t+=dt;
  draw();
  requestAnimationFrame(loop);
}

function draw(){
  const rpm=+rpmEl.value||0;
  const d1=+d1El.value||1;
  const d2=+d2El.value||1;
  const cc=+ccEl.value||1;

  const W=parseFloat(canvas.style.width);
  const H=parseFloat(canvas.style.height);

  ctx.clearRect(0,0,W,H);
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,W,H);

  const r1mm=d1/2, r2mm=d2/2;
  const Cmm=Math.max(cc,Math.abs(r2mm-r1mm)+1);

  const scale=Math.min(
    (W-80)/(Cmm+r1mm+r2mm),
    (H-80)/(2*Math.max(r1mm,r2mm))
  );

  const r1=r1mm*scale, r2=r2mm*scale, C=Cmm*scale;
  const x1=40+r1, x2=x1+C, y=H/2;

  const phi=Math.acos(Math.min(1,Math.max(-1,(r2-r1)/C)));

  const aL_top= phi, aL_bot=-phi;
  const aR_top=Math.PI-phi, aR_bot=Math.PI+phi;

  const Ltop={x:x1+r1*Math.cos(aL_top),y:y+r1*Math.sin(aL_top)};
  const Lbot={x:x1+r1*Math.cos(aL_bot),y:y+r1*Math.sin(aL_bot)};
  const Rtop={x:x2+r2*Math.cos(aR_top),y:y+r2*Math.sin(aR_top)};
  const Rbot={x:x2+r2*Math.cos(aR_bot),y:y+r2*Math.sin(aR_bot)};

  // === DESSIN COURROIE SEULE ===
  ctx.strokeStyle="#9a9a9a";
  ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(Ltop.x,Ltop.y);
  ctx.lineTo(Rtop.x,Rtop.y);
  ctx.arc(x2,y,r2,aR_top,aR_bot,false);
  ctx.lineTo(Lbot.x,Lbot.y);
  ctx.arc(x1,y,r1,aL_bot,aL_top,false);
  ctx.stroke();

  // === POINT SUR COURROIE ===
  const w1=TAU*(rpm/60);
  const v=Math.abs(w1)*r1;

  const lenTop=Math.hypot(Rtop.x-Ltop.x,Rtop.y-Ltop.y);
  const lenBot=Math.hypot(Lbot.x-Rbot.x,Lbot.y-Rbot.y);
  const lenArcR=r2*(TAU-2*phi);
  const lenArcL=r1*(2*phi);
  const beltLen=lenTop+lenArcR+lenBot+lenArcL;

  let s=(v*t)%beltLen,P;

  if(s<=lenTop) P=lerp(Ltop,Rtop,s/lenTop);
  else if((s-=lenTop)<=lenArcR){
    const a=aR_top-(s/lenArcR)*(TAU-2*phi);
    P={x:x2+r2*Math.cos(a),y:y+r2*Math.sin(a)};
  }
  else if((s-=lenArcR)<=lenBot) P=lerp(Rbot,Lbot,s/lenBot);
  else{
    s-=lenBot;
    const a=aL_bot+(s/lenArcL)*(2*phi);
    P={x:x1+r1*Math.cos(a),y:y+r1*Math.sin(a)};
  }

  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(P.x,P.y,5,0,TAU);
  ctx.fill();
}

requestAnimationFrame(loop);
})();
</script>
</body>
</html>