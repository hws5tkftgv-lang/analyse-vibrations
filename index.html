<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Courroie & poulies â€” open belt correct</title>

<style>
body{
  margin:0;
  background:#0b1436;
  color:#eaf1ff;
  font-family:Arial,system-ui,sans-serif;
}
header{padding:14px;font-size:18px;font-weight:700}
canvas{
  display:block;
  margin:12px auto;
  background:#000;
  border-radius:14px;
}
.controls{padding:12px;display:grid;gap:8px}
input{padding:10px;font-size:16px;border-radius:10px;border:none}
</style>
</head>

<body>
<header>ðŸ”„ Courroie & poulies â€” gÃ©omÃ©trie correcte (open belt)</header>

<div class="controls">
<input id="rpm" type="number" value="1500" placeholder="RPM moteur">
<input id="d1" type="number" value="4" placeholder="Ã˜ menante (po)">
<input id="d2" type="number" value="9" placeholder="Ã˜ menÃ©e (po)">
<input id="cc" type="number" value="21" placeholder="Centre Ã  centre (po)">
</div>

<canvas id="c" width="900" height="360"></canvas>

<script>
const c=document.getElementById("c");
const ctx=c.getContext("2d");
const IN=25.4,TAU=Math.PI*2;

let t=0,last=0;

function loop(ts){
  const dt=(ts-last)/1000; last=ts;
  t+=dt*0.25;
  draw();
  requestAnimationFrame(loop);
}

function draw(){
  ctx.clearRect(0,0,c.width,c.height);

  let rpm=+rpm.value||1;
  let d1=+d1.value||1;
  let d2=+d2.value||1;
  let cc=+cc.value||1;

  d1*=IN; d2*=IN; cc*=IN;

  const R1=d1/2, R2=d2/2;
  const C=Math.max(cc,Math.abs(R2-R1)+1);

  const scale=Math.min(
    (c.width-120)/(C+R1+R2),
    (c.height-80)/(2*Math.max(R1,R2))
  );

  const r1=R1*scale, r2=R2*scale, Cpx=C*scale;
  const x1=80+r1, x2=x1+Cpx, y=c.height/2;

  const alpha=Math.asin((R2-R1)/C);

  const t1=alpha;
  const t2=Math.PI-alpha;

  const L1={x:x1+r1*Math.cos(t1),y:y+r1*Math.sin(t1)};
  const L2={x:x1+r1*Math.cos(-t1),y:y+r1*Math.sin(-t1)};
  const R1p={x:x2+r2*Math.cos(t2),y:y+r2*Math.sin(t2)};
  const R2p={x:x2+r2*Math.cos(-t2),y:y+r2*Math.sin(-t2)};

  // courroie
  ctx.strokeStyle="#aaa"; ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(L1.x,L1.y);
  ctx.lineTo(R1p.x,R1p.y);
  ctx.arc(x2,y,r2,t2,-t2,false);      // grande poulie EXTERNE
  ctx.lineTo(L2.x,L2.y);
  ctx.arc(x1,y,r1,-t1,t1,false);      // petite poulie EXTERNE
  ctx.stroke();

  // poulies
  function pulley(x,y,r,col,a){
    ctx.strokeStyle=col; ctx.lineWidth=3;
    ctx.beginPath(); ctx.arc(x,y,r,0,TAU); ctx.stroke();
    ctx.fillStyle=col;
    ctx.beginPath();
    ctx.arc(x+(r-6)*Math.cos(a),y+(r-6)*Math.sin(a),6,0,TAU);
    ctx.fill();
  }

  const w1=TAU*(rpm/60);
  const w2=w1*(R1/R2);

  pulley(x1,y,r1,"#00a2ff",-w1*t);
  pulley(x2,y,r2,"#ff9800",-w2*t);

  // point sur courroie (mÃªme chemin)
  const Ltop=Math.hypot(R1p.x-L1.x,R1p.y-L1.y);
  const Lbot=Math.hypot(L2.x-R2p.x,L2.y-R2p.y);
  const A1=r1*(Math.PI-2*alpha);
  const A2=r2*(Math.PI+2*alpha);
  const Ltot=Ltop+A2+Lbot+A1;

  let s=(w1*r1*t)%Ltot, P;

  if(s<Ltop){
    const u=s/Ltop;
    P={x:L1.x+(R1p.x-L1.x)*u,y:L1.y+(R1p.y-L1.y)*u};
  }else if((s-=Ltop)<A2){
    const a=t2-s/A2*(Math.PI+2*alpha);
    P={x:x2+r2*Math.cos(a),y:y+r2*Math.sin(a)};
  }else if((s-=A2)<Lbot){
    const u=s/Lbot;
    P={x:R2p.x+(L2.x-R2p.x)*u,y:R2p.y+(L2.y-R2p.y)*u};
  }else{
    s-=Lbot;
    const a=-t1+s/A1*(Math.PI-2*alpha);
    P={x:x1+r1*Math.cos(a),y:y+r1*Math.sin(a)};
  }

  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(P.x,P.y,5,0,TAU);
  ctx.fill();
}

requestAnimationFrame(loop);
</script>
</body>
</html>