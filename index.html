<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Poulies & courroie ‚Äî simulation p√©dagogique</title>

<style>
:root{
  --bg:#0b1436;
  --panel:#101a40;
  --text:#eaf1ff;
  --muted:rgba(234,241,255,.65);
  --blue:#00a2ff;
  --orange:#ff9800;
  --belt:#9a9a9a;
}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:Arial;}
.controls,.buttons,.results{padding:10px 14px;}
.controls{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;}
.controls label{font-size:12px;color:var(--muted);}
.controls input,.controls select{padding:7px 9px;border-radius:8px;border:none;}
.controls .full{grid-column:1/-1;}
.buttons{display:flex;gap:10px;}
button{flex:1;padding:10px;border:none;border-radius:10px;background:#1c2b6a;color:white;}
canvas{width:100%;background:#000;border-radius:12px;display:block;}
.dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;}
.blue{background:var(--blue);} .orange{background:var(--orange);} .white{background:#fff;}
.rowLine{margin-top:6px;}
.smallMuted{color:var(--muted);font-size:12px;}
</style>
</head>

<body>

<div class="controls">
  <label>RPM moteur
    <input id="rpm" type="number" placeholder="ex: 1500">
  </label>

  <label>Unit√©s
    <select id="unit">
      <option value="imperial" selected>po</option>
      <option value="metric">mm</option>
    </select>
  </label>

  <label>√ò menante
    <input id="d1" type="number" placeholder="ex: 4">
  </label>

  <label>√ò men√©e
    <input id="d2" type="number" placeholder="ex: 9">
  </label>

  <label class="full">C-C
    <input id="cc" type="number" placeholder="ex: 21">
  </label>

  <label class="full">Ralenti
    <input id="slow" type="range" min="1" max="20" step="1" value="8">
  </label>
</div>

<div class="buttons">
  <button id="play">‚ñ∂Ô∏è Play</button>
  <button id="pause">‚è∏ Pause</button>
  <button id="reset">üîÑ Reset</button>
</div>

<canvas id="scene"></canvas>
<div class="results" id="info"></div>

<script>
(() => {
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");

const rpmEl = document.getElementById("rpm");
const d1El  = document.getElementById("d1");
const d2El  = document.getElementById("d2");
const ccEl  = document.getElementById("cc");
const unitEl= document.getElementById("unit");
const slowEl= document.getElementById("slow");
const infoEl= document.getElementById("info");

const playBtn=document.getElementById("play");
const pauseBtn=document.getElementById("pause");
const resetBtn=document.getElementById("reset");

const TAU=Math.PI*2;
const IN_TO_MM=25.4;
const BASE_TIME_SCALE=0.06;

let t=0,running=false,lastTS=null,lockedW=null;

function resize(){
  if(!lockedW) lockedW=Math.min(innerWidth-24,720);
  const w=lockedW,h=w*0.6,dpr=Math.min(3,devicePixelRatio||1);
  canvas.style.width=w+"px";
  canvas.style.height=h+"px";
  canvas.width=w*dpr;
  canvas.height=h*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
addEventListener("resize",resize); resize();

function read(){
  let rpm=+rpmEl.value,d1=+d1El.value,d2=+d2El.value,cc=+ccEl.value;
  if(!rpm||!d1||!d2||!cc) return null;
  if(unitEl.value==="imperial"){d1*=IN_TO_MM;d2*=IN_TO_MM;cc*=IN_TO_MM;}
  return {rpm,d1,d2,cc};
}

playBtn.onclick=()=>{if(read()) running=true;};
pauseBtn.onclick=()=>running=false;
resetBtn.onclick=()=>{running=false;t=0;rpmEl.value=d1El.value=d2El.value=ccEl.value="";};

function lerp(a,b,u){return{x:a.x+(b.x-a.x)*u,y:a.y+(b.y-a.y)*u};}

function loop(ts){
  if(!lastTS) lastTS=ts;
  const dt=(ts-lastTS)/1000; lastTS=ts;
  if(running) t+=dt*BASE_TIME_SCALE/slowEl.value;
  draw(); requestAnimationFrame(loop);
}

function draw(){
  const W=parseFloat(canvas.style.width),H=parseFloat(canvas.style.height);
  ctx.clearRect(0,0,W,H); ctx.fillStyle="#000"; ctx.fillRect(0,0,W,H);

  const inp=read();
  if(!inp){infoEl.innerHTML="<span class='smallMuted'>En attente des donn√©es‚Ä¶</span>";return;}

  const {rpm,d1,d2,cc}=inp;
  const r1=d1/2,r2=d2/2;
  const C=Math.max(cc,Math.abs(r2-r1)+1e-6);
  const phi=Math.acos((r2-r1)/C);

  const margin=40;
  const s=Math.min((W-2*margin)/(C+r1+r2),(H-2*margin)/(2*Math.max(r1,r2)));
  const R1=r1*s,R2=r2*s,CC=C*s;

  const x1=margin+R1,x2=x1+CC,y=H/2;

  const aL1=phi,aL2=-phi,aR1=Math.PI-phi,aR2=Math.PI+phi;

  const Ltop={x:x1+R1*Math.cos(aL1),y:y+R1*Math.sin(aL1)};
  const Lbot={x:x1+R1*Math.cos(aL2),y:y+R1*Math.sin(aL2)};
  const Rtop={x:x2+R2*Math.cos(aR1),y:y+R2*Math.sin(aR1)};
  const Rbot={x:x2+R2*Math.cos(aR2),y:y+R2*Math.sin(aR2)};

  ctx.strokeStyle="var(--belt)";ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(Ltop.x,Ltop.y);
  ctx.lineTo(Rtop.x,Rtop.y);
  ctx.arc(x2,y,R2,aR1,aR2,false);
  ctx.lineTo(Lbot.x,Lbot.y);
  ctx.arc(x1,y,R1,aL2,aL1,false);
  ctx.stroke();

  const f1=rpm/60,w1=TAU*f1;
  const ang1=-w1*t, ang2=-(TAU*(rpm*(d1/d2)/60))*t;

  function pulley(x,y,r,a,c){
    ctx.strokeStyle=c;ctx.lineWidth=3;
    ctx.beginPath();ctx.arc(x,y,r,0,TAU);ctx.stroke();
    ctx.fillStyle=c;
    ctx.beginPath();ctx.arc(x+(r-6)*Math.cos(a),y+(r-6)*Math.sin(a),6,0,TAU);ctx.fill();
  }
  pulley(x1,y,R1,ang1,"#00a2ff");
  pulley(x2,y,R2,ang2,"#ff9800");

  const v=Math.abs(w1)*R1;
  const lenTop=Math.hypot(Rtop.x-Ltop.x,Rtop.y-Ltop.y);
  const lenBot=Math.hypot(Lbot.x-Rbot.x,Lbot.y-Rbot.y);
  const arcBig=R2*(TAU-2*phi);
  const arcSmall=R1*(2*phi);
  const L=lenTop+arcBig+lenBot+arcSmall;

  let sPos=(v*t)%L,P;
  if(sPos<lenTop)P=lerp(Ltop,Rtop,sPos/lenTop);
  else if((sPos-=lenTop)<arcBig){const a=aR1-(sPos/arcBig)*(TAU-2*phi);P={x:x2+R2*Math.cos(a),y:y+R2*Math.sin(a)};}
  else if((sPos-=arcBig)<lenBot)P=lerp(Rbot,Lbot,sPos/lenBot);
  else{const a=aL2+(sPos-lenBot)/arcSmall*(2*phi);P={x:x1+R1*Math.cos(a),y:y+R1*Math.sin(a)};}

  ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(P.x,P.y,5,0,TAU);ctx.fill();

  const span=Math.sqrt(C*C-(r2-r1)*(r2-r1));
  const beltLen=2*span+(r1+r2)*(TAU-2*phi);
  const beltOut=(unitEl.value==="imperial")?(beltLen/IN_TO_MM).toFixed(2)+" po":beltLen.toFixed(1)+" mm";

  infoEl.innerHTML=`
    <div class="rowLine"><span class="dot white"></span><b>Longueur courroie</b> : ${beltOut}</div>
  `;
}

requestAnimationFrame(loop);
})();
</script>
</body>
</html>