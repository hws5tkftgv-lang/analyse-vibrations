<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Poulie menante — géométrie correcte</title>
<style>
html,body{
  margin:0;
  background:#0b1436;
  color:#eaf1ff;
  font-family:Arial,sans-serif;
}
canvas{
  display:block;
  margin:40px auto;
  background:#000;
  border-radius:12px;
}
</style>
</head>
<body>

<canvas id="c" width="600" height="300"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

const TAU = Math.PI*2;

let t = 0;

function loop(){
  t += 0.01;
  draw();
  requestAnimationFrame(loop);
}

function draw(){
  ctx.clearRect(0,0,600,300);

  const cx = 220;
  const cy = 150;
  const r  = 60;

  // angle de contact (choisi volontairement)
  const phi = Math.PI / 4; // 45°

  // points de tangence
  const top = {
    x: cx + r*Math.cos(-phi),
    y: cy + r*Math.sin(-phi)
  };
  const bot = {
    x: cx + r*Math.cos(phi),
    y: cy + r*Math.sin(phi)
  };

  // --- COURROIE ---
  ctx.strokeStyle = "#9a9a9a";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(top.x-220, top.y-40); // segment haut
  ctx.lineTo(top.x, top.y);

  // ARC CONVEXE (extérieur)
  ctx.arc(cx, cy, r, -phi, phi, false);

  ctx.lineTo(bot.x-220, bot.y+40); // segment bas
  ctx.stroke();

  // --- POULIE ---
  ctx.strokeStyle = "#00a2ff";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.arc(cx,cy,r,0,TAU);
  ctx.stroke();

  // --- POINT QUI SE DÉPLACE ---
  const arcLen = r * (2*phi);
  const segLen = 300;
  const total = segLen + arcLen + segLen;

  let s = (t*80) % total;
  let p;

  if(s < segLen){
    const u = s/segLen;
    p = {
      x: (top.x-220)*(1-u) + top.x*u,
      y: (top.y-40)*(1-u) + top.y*u
    };
  }
  else if((s -= segLen) < arcLen){
    const u = s/arcLen;
    const a = -phi + u*(2*phi);
    p = {
      x: cx + r*Math.cos(a),
      y: cy + r*Math.sin(a)
    };
  }
  else{
    s -= arcLen;
    const u = s/segLen;
    p = {
      x: bot.x*(1-u) + (bot.x-220)*u,
      y: bot.y*(1-u) + (bot.y+40)*u
    };
  }

  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(p.x,p.y,5,0,TAU);
  ctx.fill();
}

loop();
</script>
</body>
</html>