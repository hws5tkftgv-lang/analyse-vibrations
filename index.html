<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Poulies & courroie ‚Äî simulation (p√©dagogie)</title>

<style>
:root{
  --bg:#0b1436;
  --panel:#101a40;
  --text:#eaf1ff;
  --muted:rgba(234,241,255,.65);
  --blue:#00a2ff;
  --orange:#ff9800;
  --belt:#9a9a9a;
  --btn:#1c2b6a;
}
*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html,body{ margin:0; background:var(--bg); color:var(--text); font-family:Arial,system-ui,sans-serif; }

header{
  padding:10px 14px;
  font-size:16px;
  font-weight:700;
}

.controls{
  padding:10px 14px;
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
}
.controls label{ font-size:12px; color:var(--muted); }
.controls input, .controls select{
  width:100%;
  padding:7px 9px;
  font-size:14px;
  border-radius:10px;
  border:none;
}
.controls .full{ grid-column:1 / -1; }

.buttons{
  display:flex;
  gap:10px;
  padding:0 14px 10px;
}
button{
  flex:1;
  padding:10px;
  font-size:15px;
  border:none;
  border-radius:12px;
  background:var(--btn);
  color:white;
}

.stage{ padding:10px 14px; }
canvas{
  width:100%;
  background:#000;
  border-radius:12px;
  display:block;
}

.results{
  padding:10px 14px 18px;
  font-size:14px;
  line-height:1.45;
}

.smallMuted{ color:var(--muted); font-size:12px; }
.rowLine{ margin-top:6px; }

.dot{
  display:inline-block;width:10px;height:10px;border-radius:50%;
  margin-right:6px;vertical-align:-1px;
}
.blue{ background:var(--blue); }
.orange{ background:var(--orange); }
.white{ background:#fff; }

.sliderWrap{ display:flex; align-items:center; gap:10px; }
#slow{ flex:1; }
#slowVal{ min-width:64px; text-align:right; font-size:12px; color:var(--muted); }
</style>
</head>

<body>
<header>üîÑ Poulies & courroie ‚Äî simulation</header>

<div class="controls">
  <label>RPM moteur
    <input id="rpm" type="number" placeholder="ex: 1500">
  </label>

  <label>Unit√©s
    <select id="unit">
      <option value="imperial" selected>po</option>
      <option value="metric">mm</option>
    </select>
  </label>

  <label>√ò menante
    <input id="d1" type="number" placeholder="ex: 4">
  </label>

  <label>√ò men√©e
    <input id="d2" type="number" placeholder="ex: 9">
  </label>

  <label class="full">C-C
    <input id="cc" type="number" placeholder="ex: 21">
  </label>

  <div class="full">
    <div class="smallMuted">Ralenti animation</div>
    <div class="sliderWrap">
      <input id="slow" type="range" min="1" max="20" step="1" value="8">
      <div id="slowVal">√ó8</div>
    </div>
  </div>
</div>

<div class="buttons">
  <button id="play">‚ñ∂Ô∏è Play</button>
  <button id="pause">‚è∏ Pause</button>
  <button id="reset">üîÑ Reset</button>
</div>

<div class="stage">
  <canvas id="scene"></canvas>
</div>

<div class="results" id="info"></div>

<script>
(() => {
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");

const rpmEl = document.getElementById("rpm");
const d1El  = document.getElementById("d1");
const d2El  = document.getElementById("d2");
const ccEl  = document.getElementById("cc");
const unitEl= document.getElementById("unit");
const infoEl= document.getElementById("info");

const slowEl = document.getElementById("slow");
const slowVal= document.getElementById("slowVal");

const playBtn=document.getElementById("play");
const pauseBtn=document.getElementById("pause");
const resetBtn=document.getElementById("reset");

const TAU=Math.PI*2;
const IN_TO_MM=25.4;
const BASE_TIME_SCALE=0.06;

let t=0, running=false, lastTS=null, lockedWidth=null;

function resize(){
  if(lockedWidth===null) lockedWidth=Math.min(innerWidth-24,720);
  const w=lockedWidth, h=w*0.6, dpr=Math.min(3,devicePixelRatio||1);
  canvas.style.width=w+"px";
  canvas.style.height=h+"px";
  canvas.width=w*dpr;
  canvas.height=h*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
addEventListener("resize",resize); resize();

function readInputsMM(){
  let rpm=+rpmEl.value, d1=+d1El.value, d2=+d2El.value, cc=+ccEl.value;
  if(!rpm||!d1||!d2||!cc) return null;
  if(unitEl.value==="imperial"){ d1*=IN_TO_MM; d2*=IN_TO_MM; cc*=IN_TO_MM; }
  return {rpm,d1mm:d1,d2mm:d2,ccmm:cc};
}

playBtn.onclick=()=>{ if(readInputsMM()) running=true; };
pauseBtn.onclick=()=>running=false;
resetBtn.onclick=()=>{
  running=false; t=0;
  rpmEl.value=d1El.value=d2El.value=ccEl.value="";
  draw();
};

slowEl.oninput=()=>slowVal.textContent="√ó"+slowEl.value;

function loop(ts){
  if(!lastTS) lastTS=ts;
  const dt=(ts-lastTS)/1000; lastTS=ts;
  if(running) t+=dt*BASE_TIME_SCALE/slowEl.value;
  draw(); requestAnimationFrame(loop);
}

function draw(){
  const W=parseFloat(canvas.style.width), H=parseFloat(canvas.style.height);
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle="#000"; ctx.fillRect(0,0,W,H);

  const inp=readInputsMM();
  if(!inp){ infoEl.innerHTML="<span class='smallMuted'>En attente des donn√©es‚Ä¶</span>"; return; }

  const {rpm,d1mm,d2mm,ccmm}=inp;
  const r1mm=d1mm/2, r2mm=d2mm/2;
  const Cmm=Math.max(ccmm,Math.abs(r2mm-r1mm)+1e-6);
  const phi=Math.acos((r2mm-r1mm)/Cmm);

  const span=Math.sqrt(Cmm*Cmm-(r2mm-r1mm)*(r2mm-r1mm));
  const beltLen_mm=2*span+(r1mm+r2mm)*(TAU-2*phi);
  const beltLen=(unitEl.value==="imperial")
    ? (beltLen_mm/IN_TO_MM).toFixed(2)+" po"
    : beltLen_mm.toFixed(1)+" mm";

  infoEl.innerHTML=`
    <div class="rowLine"><span class="dot white"></span><b>Longueur courroie</b> : ${beltLen}</div>
  `;
}

requestAnimationFrame(loop);
})();
</script>
</body>
</html>