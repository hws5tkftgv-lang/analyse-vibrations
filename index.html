<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Courroie â€” trajectoire correcte</title>

<style>
html,body{
  margin:0;
  background:#0b1436;
  color:#eaf1ff;
  font-family:Arial,system-ui,sans-serif;
}
header{
  padding:12px;
  font-weight:700;
}
.stage{
  padding:12px;
}
canvas{
  width:100%;
  background:#000;
  border-radius:12px;
  display:block;
}
</style>
</head>

<body>
<header>Courroie seule â€” trajectoire correcte</header>

<div class="stage">
  <canvas id="scene"></canvas>
</div>

<script>
(() => {
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");

const TAU = Math.PI * 2;

let t = 0;
let lastTS = null;

// ===== Resize propre (petit dessin) =====
function resize(){
  const w = Math.min(window.innerWidth - 24, 500);
  const h = w * 0.4;              // ðŸ‘ˆ PLUS PETIT
  const dpr = Math.min(2, devicePixelRatio || 1);

  canvas.style.width = w+"px";
  canvas.style.height = h+"px";
  canvas.width = w * dpr;
  canvas.height = h * dpr;

  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener("resize", resize);
resize();

// ===== GÃ©omÃ©trie de la courroie =====
function draw(){
  const W = canvas.width / (devicePixelRatio||1);
  const H = canvas.height / (devicePixelRatio||1);

  ctx.clearRect(0,0,W,H);
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,W,H);

  // Dimensions de la capsule
  const margin = 40;
  const R = 30;                             // rayon des demi-cercles
  const xL = margin + R;
  const xR = W - margin - R;
  const y  = H/2;

  const topL = {x:xL, y:y-R};
  const topR = {x:xR, y:y-R};
  const botR = {x:xR, y:y+R};
  const botL = {x:xL, y:y+R};

  // ===== Dessin de la courroie =====
  ctx.strokeStyle="#9a9a9a";
  ctx.lineWidth=4;
  ctx.lineCap="round";
  ctx.lineJoin="round";

  ctx.beginPath();
  ctx.moveTo(topL.x, topL.y);          // ligne haut
  ctx.lineTo(topR.x, topR.y);

  ctx.arc(xR, y, R, -Math.PI/2, Math.PI/2, false); // demi-cercle droit

  ctx.lineTo(botL.x, botL.y);           // ligne bas

  ctx.arc(xL, y, R, Math.PI/2, -Math.PI/2, false); // demi-cercle gauche
  ctx.stroke();

  // ===== Longueurs =====
  const lenTop = topR.x - topL.x;
  const lenBot = lenTop;
  const lenArc = Math.PI * R;

  const totalLen = lenTop + lenArc + lenBot + lenArc;

  // ===== Animation =====
  const speed = 80; // px/s (constant)
  const s = (t * speed) % totalLen;
  let P;

  if(s <= lenTop){
    const u = s / lenTop;
    P = { x: topL.x + u*(topR.x-topL.x), y: topL.y };
  }
  else if(s <= lenTop + lenArc){
    const u = (s-lenTop)/lenArc;
    const a = -Math.PI/2 + u*Math.PI;
    P = { x: xR + R*Math.cos(a), y: y + R*Math.sin(a) };
  }
  else if(s <= lenTop + lenArc + lenBot){
    const u = (s-lenTop-lenArc)/lenBot;
    P = { x: botR.x - u*(botR.x-botL.x), y: botR.y };
  }
  else{
    const u = (s-lenTop-lenArc-lenBot)/lenArc;
    const a = Math.PI/2 + u*Math.PI;
    P = { x: xL + R*Math.cos(a), y: y + R*Math.sin(a) };
  }

  // ===== Point blanc =====
  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(P.x,P.y,6,0,TAU);
  ctx.fill();
}

// ===== Loop =====
function loop(ts){
  if(!lastTS) lastTS = ts;
  const dt = (ts-lastTS)/1000;
  lastTS = ts;
  t += dt;
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
})();
</script>
</body>
</html>