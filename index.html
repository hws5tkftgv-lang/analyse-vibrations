<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Poulies & courroie â€” simulation (pÃ©dagogie)</title>

<style>
:root{
  --bg:#0b1436;
  --panel:#101a40;
  --text:#eaf1ff;
  --muted:rgba(234,241,255,.65);
  --blue:#00a2ff;
  --orange:#ff9800;
  --belt:#9a9a9a;
  --btn:#1c2b6a;
}
*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html,body{ margin:0; background:var(--bg); color:var(--text); font-family:Arial,system-ui,sans-serif; }
header{ padding:10px 14px; font-size:16px; font-weight:700; }
.controls{ padding:10px 14px; display:grid; grid-template-columns:repeat(2,1fr); gap:8px; }
.controls label{ font-size:12px; color:var(--muted); }
.controls input,.controls select{ width:100%; padding:7px 9px; font-size:14px; border-radius:10px; border:none; }
.controls .full{ grid-column:1/-1; }
.buttons{ display:flex; gap:10px; padding:0 14px 10px; }
button{ flex:1; padding:10px; font-size:15px; border:none; border-radius:12px; background:var(--btn); color:white; }
.stage{ padding:10px 14px; }
canvas{ width:100%; background:#000; border-radius:12px; display:block; }
.results{ padding:10px 14px 18px; font-size:14px; line-height:1.45; }
.dot{ display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px; }
.blue{background:var(--blue);} .orange{background:var(--orange);} .white{background:#fff;}
</style>
</head>

<body>
<header>ðŸ”„ Poulies & courroie â€” simulation (pÃ©dagogie)</header>

<div class="controls">
  <label>RPM moteur <input id="rpm" type="number"></label>
  <label>UnitÃ©s
    <select id="unit"><option value="imperial">po</option><option value="metric">mm</option></select>
  </label>
  <label>Ã˜ menante <input id="d1" type="number"></label>
  <label>Ã˜ menÃ©e <input id="d2" type="number"></label>
  <label class="full">C-C <input id="cc" type="number"></label>
  <div class="full">
    <input id="slow" type="range" min="1" max="20" value="8">
  </div>
</div>

<div class="buttons">
  <button id="play">Play</button>
  <button id="pause">Pause</button>
  <button id="reset">Reset</button>
</div>

<div class="stage"><canvas id="scene"></canvas></div>
<div class="results" id="info"></div>

<script>
(() => {
const canvas=document.getElementById("scene"),ctx=canvas.getContext("2d");
const rpmEl=rpm,d1El=d1,d2El=d2,ccEl=cc,unitEl=unit,infoEl=info;
const TAU=Math.PI*2,IN_TO_MM=25.4,BASE_TIME_SCALE=0.06;
let t=0,running=false,lastTS=null,lockedWidth=null;

const lerp=(p,q,u)=>({x:p.x+(q.x-p.x)*u,y:p.y+(q.y-p.y)*u});
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

function resize(){
 if(!lockedWidth) lockedWidth=Math.min(innerWidth-24,720);
 const w=lockedWidth,h=w*0.6,dpr=Math.min(3,devicePixelRatio||1);
 canvas.style.width=w+"px";canvas.style.height=h+"px";
 canvas.width=w*dpr;canvas.height=h*dpr;
 ctx.setTransform(dpr,0,0,dpr,0,0);
}
addEventListener("resize",resize);resize();

function read(){
 let rpm=+rpmEl.value,d1=+d1El.value,d2=+d2El.value,cc=+ccEl.value;
 if(!rpm||!d1||!d2||!cc) return null;
 if(unitEl.value==="imperial"){d1*=IN_TO_MM;d2*=IN_TO_MM;cc*=IN_TO_MM;}
 return{rpm,d1mm:d1,d2mm:d2,ccmm:cc};
}

function loop(ts){
 if(!lastTS) lastTS=ts;
 const dt=(ts-lastTS)/1000; lastTS=ts;
 if(running) t+=dt*BASE_TIME_SCALE/(+slow.value||1);
 draw(); requestAnimationFrame(loop);
}

function draw(){
 const W=canvas.width/(devicePixelRatio||1),H=canvas.height/(devicePixelRatio||1);
 ctx.clearRect(0,0,W,H);
 const inp=read(); if(!inp) return;
 const{rpm,d1mm,d2mm,ccmm}=inp;
 const r1mm=d1mm/2,r2mm=d2mm/2;
 const Cmm=Math.max(ccmm,Math.abs(r2mm-r1mm)+1e-6);
 const s=Math.min((W-80)/(Cmm+r1mm+r2mm),(H-80)/(2*Math.max(r1mm,r2mm)));
 const r1=r1mm*s,r2=r2mm*s,C=Cmm*s;
 const x1=40+r1,x2=x1+C,y=H/2;
 const phi=Math.acos(clamp((r2-r1)/C,-1,1));

 const aL_top=phi,aL_bot=-phi,aR_top=Math.PI-phi,aR_bot=Math.PI+phi;

 const Ltop={x:x1+r1*Math.cos(aL_top),y:y+r1*Math.sin(aL_top)};
 const Lbot={x:x1+r1*Math.cos(aL_bot),y:y+r1*Math.sin(aL_bot)};
 const Rtop={x:x2+r2*Math.cos(aR_top),y:y+r2*Math.sin(aR_top)};
 const Rbot={x:x2+r2*Math.cos(aR_bot),y:y+r2*Math.sin(aR_bot)};

 ctx.strokeStyle="#9a9a9a";ctx.lineWidth=4;ctx.beginPath();
 ctx.moveTo(Ltop.x,Ltop.y);ctx.lineTo(Rtop.x,Rtop.y);
 ctx.arc(x2,y,r2,aR_top,aR_bot,false);
 ctx.lineTo(Lbot.x,Lbot.y);
 ctx.arc(x1,y,r1,aL_bot,aL_top,false);
 ctx.stroke();

 const f1=rpm/60,w1=TAU*f1;
 const ang1=-w1*t,ang2=-(TAU*(rpm*(d1mm/d2mm)/60))*t;

 const drawPulley=(cx,cy,r,c,a)=>{
  ctx.strokeStyle=c;ctx.beginPath();ctx.arc(cx,cy,r,0,TAU);ctx.stroke();
  ctx.fillStyle=c;ctx.beginPath();
  ctx.arc(cx+(r-6)*Math.cos(a),cy+(r-6)*Math.sin(a),6,0,TAU);ctx.fill();
 };
 drawPulley(x1,y,r1,"#00a2ff",ang1);
 drawPulley(x2,y,r2,"#ff9800",ang2);

 const v=Math.abs(w1)*r1;
 const lenTop=Math.hypot(Rtop.x-Ltop.x,Rtop.y-Ltop.y);
 const lenBot=Math.hypot(Lbot.x-Rbot.x,Lbot.y-Rbot.y);
 const lenArcR=r2*(TAU-2*phi);
 const lenArcL=r1*(TAU-2*phi);   // âœ… CORRIGÃ‰

 const beltLen=lenTop+lenArcR+lenBot+lenArcL;
 let sPos=(v*t)%beltLen,P;

 if(sPos<=lenTop) P=lerp(Ltop,Rtop,sPos/lenTop);
 else if((sPos-=lenTop)<=lenArcR){
  const a=aR_top-(sPos/lenArcR)*(TAU-2*phi);
  P={x:x2+r2*Math.cos(a),y:y+r2*Math.sin(a)};
 }
 else if((sPos-=lenArcR)<=lenBot) P=lerp(Rbot,Lbot,sPos/lenBot);
 else{
  sPos-=lenBot;
  const a=aL_bot-(sPos/lenArcL)*(TAU-2*phi); // âœ… CORRIGÃ‰
  P={x:x1+r1*Math.cos(a),y:y+r1*Math.sin(a)};
 }

 ctx.fillStyle="#fff";ctx.beginPath();
 ctx.arc(P.x,P.y,5,0,TAU);ctx.fill();
}

play.onclick=()=>running=!!read();
pause.onclick=()=>running=false;
reset.onclick=()=>{t=0;rpmEl.value=d1El.value=d2El.value=ccEl.value="";running=false;};
requestAnimationFrame(loop);
})();
</script>
</body>
</html>